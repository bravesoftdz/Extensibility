<?xml version="1.0"?>
<root>
  <OBJECT NAME="ORDENS_SERVICO">
    <METHOD NAME="Listar" DESCRIPTION="Listar Ordens de Servi&#231;o" VERSION="165" INTFTYPE="14" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP NAME="Abertura"/>
          <GROUP NAME="Ordem"/>
        </GROUPS>
        <PARAM NAME="CLIENTE" FORMAT="N" SIZE="8" FLAGS="1" STYLE="5" PROJECTION="0" ORDER="6" LOOKUP="MILLENIUM.CLIENTES.LISTA_FILTROPOPUP" LOOKUPKEY="CLIENTE" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_CLIENTE" FIELDLABEL="Cliente" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="DATA_ABERTURA_INICIAL" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Data Inicial" GROUPNAME="Abertura" CTAB="0"/>
        <PARAM NAME="COD_ORDEM_SERVICO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="N&#250;mero da Ordem" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="GARANTIA" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Em Garantia" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="GRUPO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Grupo da Ordem" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="STATUS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="8" LOOKUP="list:'0','AG. CORRE&#199;&#195;O';'1','AG. FATURAMENTO ENTRADA';'2','AG. REPARO';'3','EM REPARO';'4','AG. FATURAMENTO';'50','EM FATURAMENTO';'5','FINALIZADO';" FIELDLABEL="Status" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="ERRO" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Com Erro" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="ORIGEM" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Origem" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="DATA_ABERTURA_FINAL" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Data Final" GROUPNAME="Abertura" CTAB="0"/>
        <PARAM NAME="FINALIZADA" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Finalizada" GROUPNAME="Ordem" CTAB="0"/>
        <PARAM NAME="CLSCLIENTE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="7" LOOKUP="MILLENIUM.CLASSIFICACAO_CLIENTE.LISTA" LOOKUPKEY="CLSCLIENTE" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Classifica&#231;&#227;o do Cliente" GROUPNAME="Ordem" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="ORDEM_SERVICO" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Ordem Servico" CTAB="0"/>
        <FIELD NAME="GRUPO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="16" FIELDLABEL="Grupo" CTAB="0"/>
        <FIELD NAME="COD_ORDEM_SERVICO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="15" FIELDLABEL="N&#250;mero da Ordem" CTAB="0"/>
        <FIELD NAME="NOME_CLIENTE" SIZE="50" FLAGS="1" PROJECTION="0" ORDER="18" FIELDLABEL="Nome Cliente" CTAB="0"/>
        <FIELD NAME="DATA_ABERTURA" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="14" FIELDLABEL="Data Abertura" CTAB="0"/>
        <FIELD NAME="STATUS" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="23" FIELDLABEL="Status" CTAB="0"/>
        <FIELD NAME="QTD_EQUIP" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="20" FIELDLABEL="Equipamentos" CTAB="0"/>
        <FIELD NAME="QTD_PECAS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="21" FIELDLABEL="Pe&#231;as" CTAB="0"/>
        <FIELD NAME="ERRO" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="22" FIELDLABEL="Erro" CTAB="0"/>
        <FIELD NAME="GARANTIA" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="17" FIELDLABEL="Garantia" CTAB="0"/>
        <FIELD NAME="ORIGEM" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="25" FIELDLABEL="Origem" CTAB="0"/>
        <FIELD NAME="NFS" SIZE="50" FLAGS="1" PROJECTION="0" ORDER="24" FIELDLABEL="Nfs" CTAB="0"/>
        <FIELD NAME="EVENTO" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="24" FIELDLABEL="Evento" CTAB="0"/>
        <FIELD NAME="CLSCLIENTE" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="19" FIELDLABEL="Classifica&#231;&#227;o" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT OS.ORDEM_SERVICO,
       OS.COD_ORDEM_SERVICO,
       C.NOME AS NOME_CLIENTE,
       OS.DATA_ABERTURA,
       OS.GRUPO,
       OS.ERRO,
       OS.GARANTIA,
       OS.ORIGEM,
       CC.DESCRICAO AS CLSCLIENTE,
       #TRANSLATE(#IF(OS.SUB_STATUS=1,50,OS.STATUS),  0:'AG. CORRE&#199;&#195;O',
                                                      1:'AG. FATURAMENTO ENTRADA',
                                                      2:'AG. REPARO',
                                                      3:'EM REPARO',
                                                      4:'AG. FATURAMENTO',
                                                      5:'FINALIZADO',
                                                     50:'EM FATURAMENTO',
                                                     ELSE : 'STATUS DESCONHECIDO') AS STATUS,

       (SELECT SUM(QUANTIDADE) FROM SI_ORDENS_SERVICO_PRODUTOS E WHERE E.ORDEM_SERVICO = OS.ORDEM_SERVICO AND EQUIPAMENTO = 'T') AS QTD_EQUIP,
       (SELECT SUM(QUANTIDADE) FROM SI_ORDENS_SERVICO_PRODUTOS E WHERE E.ORDEM_SERVICO = OS.ORDEM_SERVICO AND EQUIPAMENTO = 'F') AS QTD_PECAS,
       (SELECT LIST(NF.TIPO_OPERACAO||'-'||NF.NOTA)
        FROM SI_ORDENS_SERVICO_NFS OSF
        INNER JOIN NF ON (NF.COD_OPERACAO = OSF.COD_OPERACAO) AND
                         (NF.TIPO_OPERACAO = OSF.TIPO_OPERACAO)
        WHERE OSF.ORDEM_SERVICO = OS.ORDEM_SERVICO) AS NFS
FROM SI_ORDENS_SERVICO OS
LEFT JOIN CLIENTES C ON (C.CLIENTE = OS.CLIENTE)
LEFT JOIN CLASSIFICACAO_CLIENTE CC ON (CC.CLSCLIENTE = C.CLSCLIENTE)
WHERE [OS.COD_ORDEM_SERVICO=:COD_ORDEM_SERVICO]
      [AND OS.CLIENTE=:CLIENTE]
      [AND OS.DATA_ABERTURA BETWEEN :DATA_ABERTURA_INICIAL AND :DATA_ABERTURA_FINAL]
      [AND OS.GARANTIA=:GARANTIA]
      [AND OS.GRUPO=:GRUPO]
      [AND OS.ERRO=:ERRO]
      [AND OS.ORIGEM=:ORIGEM]
      [AND #SELECT(FINALIZADA,TRUE:{OS.STATUS=5},FALSE:{OS.STATUS&lt;>5},ELSE:{})]
      [AND CC.CLSCLIENTE=:CLSCLIENTE]
      #SELECT(STATUS,50:{AND OS.SUB_STATUS=1},ELSE:{[AND OS.STATUS=:STATUS]})
ORDER BY OS.ORDEM_SERVICO;
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>