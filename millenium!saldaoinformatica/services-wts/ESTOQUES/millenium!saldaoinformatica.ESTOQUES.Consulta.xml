<?xml version="1.0"?>
<root>
  <OBJECT NAME="ESTOQUES">
    <METHOD NAME="Consulta" DESCRIPTION="Consulta Estoque" VERSION="24" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="FILIAL" FORMAT="N" SIZE="8" FLAGS="17" STYLE="5" PROJECTION="0" ORDER="1" LOOKUP="MILLENIUM.FILIAIS.LISTA" LOOKUPKEY="FILIAL" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_FILIAL" FIELDLABEL="Filial" CTAB="0"/>
        <PARAM NAME="PRODUTO" FORMAT="N" SIZE="8" FLAGS="1" STYLE="5" PROJECTION="0" ORDER="2" LOOKUP="MILLENIUM.PRODUTOS.LISTA_POPUP3" LOOKUPKEY="PRODUTOAC" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Produto" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="COD_PRODUTO" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <FIELD NAME="DESC_PRODUTO" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Nome Produto" CTAB="0"/>
        <FIELD NAME="ESTOQUE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Estoque" CTAB="0"/>
        <FIELD NAME="RESERVA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Reserva" CTAB="0"/>
        <FIELD NAME="TOTAL" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Total" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT P.PRODUTO,
       P.COD_PRODUTO,
       P.DESCRICAO1 AS DESC_PRODUTO,
       SUM(E.SALDO) AS ESTOQUE,
       SUM(OSP.QUANTIDADE) AS RESERVA,
       SUM(E.SALDO)+SUM(OSP.QUANTIDADE) AS TOTAL
FROM ESTOQUES E
INNER JOIN PRODUTOS P ON (P.PRODUTO = E.PRODUTO)
LEFT JOIN SI_ORDENS_SERVICO_PRODUTOS OSP ON (OSP.PRODUTO = E.PRODUTO)
LEFT JOIN SI_ORDENS_SERVICO OS ON (OS.ORDEM_SERVICO = OSP.ORDEM_SERVICO) AND (OS.STATUS &lt;> 5)
WHERE E.FILIAL=:FILIAL
      [AND E.PRODUTO = P.PRODUTO]
GROUP BY P.PRODUTO,P.COD_PRODUTO,P.DESCRICAO1

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>