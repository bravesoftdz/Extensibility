<?xml version="1.0"?>
<root>
  <OBJECT NAME="INSPECOES">
    <METHOD NAME="Incluir" DESCRIPTION="Inspecionar" VERSION="64" INTFTYPE="17" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="FICHA_TECNICA" FORMAT="N" SIZE="8" FLAGS="8" PROJECTION="0" ORDER="1" FIELDLABEL="Ficha Tecnica" CTAB="0"/>
        <PARAM NAME="PRODUCAO" FORMAT="N" SIZE="8" FLAGS="8" STYLE="1" PROJECTION="0" ORDER="1" LOOKUP="INSPECOES.ConsultaOrdem" LOOKUPKEY="PRODUCAO" LOOKUPDISPLAY="N_ORDEM" FIELDLABEL="Producao" CTAB="0"/>
        <PARAM NAME="FASE" FORMAT="N" SIZE="8" FLAGS="8" PROJECTION="0" FIELDLABEL="Fase" CTAB="0"/>
        <PARAM NAME="INSPECOES" FORMAT="R" FLAGS="17" STYLE="3" PROJECTION="0" ORDER="3" LOOKUP="INSPECOES.LISTAINSPECOESFICHATECNICA" FIELDLABEL="Inspecoes" NESTEDNAME="MILLENIUM!DELCA.INSPECOES.INSPECAO" STYLEATTR="EDITONLY" CTAB="0"/>
        <PARAM NAME="QUANTIDADE_APROVADA" FORMAT="N" SIZE="8" FLAGS="17" PROJECTION="0" ORDER="2" FIELDLABEL="Quantidade Aprovada" CTAB="0"/>
        <PARAM NAME="QUANTIDADE_FASE" FORMAT="N" SIZE="8" FLAGS="129" PROJECTION="0" ORDER="1" FIELDLABEL="Quantidade Fase" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="PRODUCAO" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Producao" CTAB="0"/>
        <FIELD NAME="FASE" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Fase" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>INSERT:MAIN INTO DCA_INSPECOES (FICHA_TECNICA,PRODUCAO,FASE,DATA,USUARIO,QUANTIDADE_APROVADA)
            VALUES(:FICHA_TECNICA,:PRODUCAO,:FASE,#DATE(),#USER(),:QUANTIDADE_APROVADA)
            #RETURN(INSPECAO);


#EACH() INSPECOES AS INSP
#BEGIN
   INSERT INTO DCA_INSPECOES_ITENS (INSPECAO, FICHA_TEC_INSP,ENCONTRADO,MINIMA,MAXIMA,APROVADO,OBSERVACAO)
   VALUES (:MAIN.INSPECAO,:INSP.FICHA_TEC_INSP,:INSP.ENCONTRADO,:INSP.MINIMA,:INSP.MAXIMA,:INSP.APROVADO,:INSP.OBSERVACAO_INSP)
   #RETURN(INSPECAO_ITEM);
#END;

#CHECK("SELECT (SP.QUANTIDADE-INS.QUANTIDADE_APROVADA) AS N
        FROM SITUACAO_PRODUCAO SP
        INNER JOIN FICHAS_TECNICAS FT ON (FT.PRODUTO = SP.PRODUTO) AND (FT.ATUAL = 'T')
        INNER JOIN DCA_INSPECOES INS ON (INS.PRODUCAO=SP.PRODUCAO) AND
                                        (INS.FASE=SP.FASE) AND
                                        (INS.FICHA_TECNICA=FT.FICHA_TECNICA)
        WHERE SP.PRODUCAO=:PRODUCAO AND
              SP.FASE=:FASE AND
              FT.FICHA_TECNICA=:FICHA_TECNICA",N&lt;0,"Quantidade aprovada n&#227;o pode ser superior a quantidade produzida.");

SELECT #REPLACE(:FASE) AS FASE, #REPLACE(:PRODUCAO) AS PRODUCAO FROM DUAL;
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>