<?xml version="1.0"?>
<root>
  <OBJECT NAME="PRODUCAO">
    <METHOD NAME="ListarRetornoOficina" DESCRIPTION="Lista de retorno da oficina" VERSION="52" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP NAME="Envio Oficina"/>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="DATA_INICIAL" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Data Inicial" GROUPNAME="Envio Oficina" CTAB="0"/>
        <PARAM NAME="DATA_FINAL" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Data Final" GROUPNAME="Envio Oficina" CTAB="0"/>
        <PARAM NAME="PRODUTOS" FORMAT="R" FLAGS="1" STYLE="4" PROJECTION="0" ORDER="5" LOOKUP="MILLENIUM.PRODUTOS.LISTA_FILTROPOPUP" LOOKUPKEY="PRODUTOAC" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Produtos" NESTEDNAME="WTSSYSTEM.INTERNALTYPES.INTEGERARRAY" CTAB="0"/>
        <PARAM NAME="OFICINAS" FORMAT="R" FLAGS="1" STYLE="4" PROJECTION="0" ORDER="6" LOOKUP="MILLENIUM.FORNECEDORES.LISTAOFICINAS" LOOKUPKEY="FORNECEDOR" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_FORNECEDOR" FIELDLABEL="Oficinas" NESTEDNAME="WTSSYSTEM.INTERNALTYPES.INTEGERARRAY" CTAB="0"/>
        <PARAM NAME="SITUACAO_AUT" FORMAT="N" SIZE="8" FLAGS="17" DEFAULT="0" PROJECTION="0" ORDER="7" LOOKUP="PRODUCAO.LISTASITUACAOAUT" LOOKUPKEY="SITUACAO_AUT" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Status" CTAB="0"/>
        <PARAM NAME="ORDEM_PRODUCAO" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="N&#176; Ordem" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="MOVIMENTO_PRODUCAO" SIZE="500" PROJECTION="0" FIELDLABEL="Lancamento" CTAB="0"/>
        <FIELD NAME="DATA_INICIO" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Data Emiss&#227;o" CTAB="0"/>
        <FIELD NAME="N_ORDEM" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="N&#176; Ordem" CTAB="0"/>
        <FIELD NAME="COD_PRODUTO" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <FIELD NAME="DESC_PRODUTO" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="14" FIELDLABEL="Produto" CTAB="0"/>
        <FIELD NAME="DESC_FASE" SIZE="40" FLAGS="1" PROJECTION="0" ORDER="15" FIELDLABEL="Fase" CTAB="0"/>
        <FIELD NAME="NOME_OFICINA" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Oficina" CTAB="0"/>
        <FIELD NAME="QTD_RETORNADA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="16" FIELDLABEL="Qtd Retornada" CTAB="0"/>
        <FIELD NAME="CUSTO" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="17" FIELDLABEL="Custo" CTAB="0"/>
        <FIELD NAME="CUSTO_RETORNADO" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="18" FIELDLABEL="Valor T&#237;tulo" CTAB="0"/>
        <FIELD NAME="SITUACAO_AUT" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="19" FIELDLABEL="Status" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT LIST(MP.MOVIMENTO_PRODUCAO) AS MOVIMENTO_PRODUCAO,
       MP.DATA_INICIO,
       P.N_ORDEM,
       PR.COD_PRODUTO,
       PR.DESCRICAO1 AS DESC_PRODUTO,
       F.DESCRICAO AS DESC_FASE,
       FO.NOME AS NOME_OFICINA,
       SUM(MP.QUANTIDADE) AS QTD_RETORNADA,
       AVG(MP.CUSTO) AS CUSTO,
       SUM(MP.QUANTIDADE) * AVG(MP.CUSTO) AS CUSTO_RETORNADO,
       SA.DESCRICAO AS SITUACAO_AUT
FROM PRODUCAO P
INNER JOIN MOVIMENTO_PRODUCAO MP ON (MP.PRODUCAO = P.PRODUCAO) AND (MP.FLAGOFICINA='S')
INNER JOIN FASES F ON (F.FASE = MP.FASEI)
INNER JOIN PRODUTOS PR ON (PR.PRODUTO = MP.PRODUTO)
INNER JOIN FORNECEDORES FO ON (FO.FORNECEDOR = MP.OFICINA)
INNER JOIN MNR_SITUACAO_AUT SA ON (SA.SITUACAO_AUT = MP.MNR_SITUACAO_AUT)
WHERE MP.MNR_SITUACAO_AUT=:SITUACAO_AUT
      [AND MP.DATA_INICIO BETWEEN :DATA_INICIAL AND :DATA_FINAL]
      [AND P.N_ORDEM=:ORDEM_PRODUCAO]
      [AND MP.PRODUTO IN #MAKELIST(PRODUTOS,ITEM)]
      [AND FO.FORNECEDOR IN #MAKELIST(OFICINAS,ITEM)]
GROUP BY
       MP.DATA_INICIO,
       P.N_ORDEM,
       PR.COD_PRODUTO,
       PR.DESCRICAO1,
       F.DESCRICAO,
       FO.NOME,
       SA.DESCRICAO
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>