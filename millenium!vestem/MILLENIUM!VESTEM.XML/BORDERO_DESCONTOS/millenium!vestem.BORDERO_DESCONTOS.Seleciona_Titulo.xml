<?xml version="1.0"?>
<root>
  <OBJECT NAME="BORDERO_DESCONTOS">
    <METHOD NAME="Seleciona_Titulo" DESCRIPTION="T&#237;tulos a Receber" VERSION="1" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="ORDEM" FORMAT="N" SIZE="1" FLAGS="17" DEFAULT="0" PROJECTION="0" ORDER="1" LOOKUP="list:'0','Numero do Titulo';'1','Cliente';'2','Data de Emiss&#227;o';'3','Data de Vencimento';" FIELDLABEL="Ordem" CTAB="0"/>
        <PARAM NAME="LANCAMENTO" FORMAT="N" SIZE="8" DEFAULT="0" PROJECTION="0" ORDER="3" FIELDLABEL="Mostra titulos em bordero" CTAB="0"/>
        <PARAM NAME="DATAI" FORMAT="D" SIZE="10" FLAGS="17" DEFAULT="Today" PROJECTION="0" ORDER="2" FIELDLABEL="Data Inicial" CTAB="0"/>
        <PARAM NAME="DATAF" FORMAT="D" SIZE="10" FLAGS="17" DEFAULT="Today" PROJECTION="0" ORDER="3" FIELDLABEL="Data Final" CTAB="0"/>
        <PARAM NAME="CONTA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="5" LOOKUP="millenium.CONTAS.Listatodas" LOOKUPKEY="CONTA" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="NUMERO" FIELDLABEL="Contas" CTAB="0"/>
        <PARAM NAME="TIPO_PGTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="6" LOOKUP="millenium.TIPOS_PGTOS.Lista" LOOKUPKEY="TIPO_PGTO" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Tipo de Pagamento" CTAB="0"/>
        <PARAM NAME="MOSTRA_BORDERO" FORMAT="B" SIZE="1" FLAGS="1" DEFAULT="FALSE" PROJECTION="0" ORDER="7" FIELDLABEL="Mostra titulos em border&#244;" CTAB="0"/>
        <PARAM NAME="FILIAL" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="4" LOOKUP="millenium.filiais.lista_simples" LOOKUPKEY="FILIAL" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_FILIAL" FIELDLABEL="Filial" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="LANCAMENTO" FORMAT="N" SIZE="8" FLAGS="8" PROJECTION="0" FIELDLABEL="Cod Lancamento" CTAB="0"/>
        <FIELD NAME="DATA_EMISSAO" FORMAT="D" SIZE="14" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Data de Emiss&#227;o" CTAB="0"/>
        <FIELD NAME="DATA_VENCIMENTO" FORMAT="D" SIZE="14" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Data de Vencimento" CTAB="0"/>
        <FIELD NAME="DESC_GERADOR" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="Cliente" CTAB="0"/>
        <FIELD NAME="N_DOCUMENTO" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="N.&#186; do T&#237;tulo" CTAB="0"/>
        <FIELD NAME="VALOR_INICIAL" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="14" FIELDLABEL="Valor Inicial" CTAB="0"/>
        <FIELD NAME="VALOR_COM_DESC" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="15" FIELDLABEL="Valor Liquido" CTAB="0"/>
        <FIELD NAME="NOTA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="NF" CTAB="0"/>
        <FIELD NAME="DESC_TIPO_PGTO" SIZE="35" FLAGS="1" PROJECTION="0" ORDER="16" FIELDLABEL="Tipo Pgto" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>//#PRIVATE()
//#CALL:DATAS_FILIAIS2 MILLENIUM.TITULOS_RECEBER.PIVOTDATASFILIAL(:FILIAIS_DATA);

//#SET(TBL, ${#CREATETABLE(FILIAL INT, DATA DATE)});

//#EACH() :DATAS_FILIAIS2;
//INSERT INTO #REPLACE(TBL) (FILIAL, DATA)
//VALUES (:DATAS_FILIAIS2.FILIAL, :DATAS_FILIAIS2.DATA);

//#PRIVATE()
//#CALL:DATAS_FILIAIS MILLENIUM.TITULOS_RECEBER.PIVOTDATASFILIAL(:FILIAIS_DATA);

//Par&#226;metro EFETUADO (invis&#237;vel) para Border&#244; (Inc/Alt)
  SELECT L.LANCAMENTO,
         MIN(L.DATA_PAGAMENTO) AS DATA_PAGAMENTO,
         MIN(L.VALOR_PAGO) AS VALOR_PAGO,
         MIN(L.DATA_EMISSAO) AS DATA_EMISSAO,
         MIN(L.DATA_VENCIMENTO) AS DATA_VENCIMENTO,
        (MIN(L.GERADOR) || MIN(L.DESC_GERADOR) ) AS DESC_GERADOR,
         MIN(L.N_DOCUMENTO) AS N_DOCUMENTO,
         MIN(L.VALOR_INICIAL) AS VALOR_INICIAL,
         MIN(TP.DESCRICAO) AS DESC_TIPO_PGTO,
         MIN(L.OBS) AS OBS,
         MIN(NF.NOTA) AS NOTA,
         MIN(L.COBRANCA) AS COBRANCA,
         MIN(DL.VAL_DESC) AS DESC_VALOR,
         MIN(L.VALOR_INICIAL) - MIN(#NULL_TO_Z(DL.VAL_DESC)) + MIN(#NULL_TO_Z(DL.VAL_CUST)) AS VALOR_COM_DESC

  FROM LANCAMENTOS L
  INNER JOIN TIPOS_PGTOS TP
        ON L.TIPO_PGTO = TP.TIPO_PGTO
  INNER JOIN CALC_VAL_LIQ DL
        ON L.LANCAMENTO = DL.LANCAMENTO
  INNER JOIN FILIAIS F
        ON L.FILIAL = F.FILIAL
  LEFT JOIN NF
        ON NF.COD_OPERACAO = L.ORIGEM
        AND NF.TIPO_OPERACAO = L.TIPO_ORIGEM
        AND ( NF.CANCELADA = FALSE OR NF.CANCELADA IS NULL )

WHERE L.TIPO     = 'R'
AND   L.TITULO   = 'T'
AND   L.EFETUADO = 'F'

#SELECT( MOSTRA_BORDERO, TRUE:{}, ELSE:{
 AND (L.COBRANCA='F' OR L.COBRANCA IS NULL) } )

AND  L.DATA_VENCIMENTO BETWEEN :DATAI AND :DATAF
[ AND L.CONTA     = :CONTA]
[ AND L.TIPO_PGTO =:TIPO_PGTO]
[ AND F.FILIAL    =:FILIAL]

  
#SELECT((LANCAMENTO > 0), True:{[ AND L.LANCAMENTO = :LANCAMENTO ]}, else:{})


  GROUP BY L.LANCAMENTO
  ORDER BY #SELECT(ORDEM,
              0: {N_DOCUMENTO},
              1: {DESC_GERADOR},
              2: {DATA_EMISSAO},
              3: {DATA_VENCIMENTO})
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>