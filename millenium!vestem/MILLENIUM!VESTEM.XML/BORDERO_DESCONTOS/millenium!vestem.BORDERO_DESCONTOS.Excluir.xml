<?xml version="1.0"?>
<root>
  <OBJECT NAME="BORDERO_DESCONTOS">
    <METHOD NAME="Excluir" DESCRIPTION="Exclui Bordero" VERSION="7" INTFTYPE="3" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="BORDERO" FORMAT="+" SIZE="8" FLAGS="1048" PROJECTION="0" FIELDLABEL="Bordero" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP STYLE="1"/>
          <GROUP NAME="Taxa Financeira"/>
          <GROUP NAME="T&#237;tulos" STYLE="1"/>
        </GROUPS>
      </FIELDS>
      <ACTIONSCRIPT>#CHECK("SELECT COUNT(*) AS N FROM LANCAMENTOS L INNER JOIN BORDERO_LANCAMENTOS BP ON BP.LANCAMENTO = L.LANCAMENTO WHERE L.EFETUADO = TRUE AND BP.BORDERO=:BORDERO", N>0, "Exclus&#227;o negada. Existem titulo j&#225; efetuados");

#CHECK("SELECT COUNT(*) AS N FROM BORDERO WHERE (BORDERO=:BORDERO) and REMESSA IS NOT NULL", N>0, "Exclus&#227;o negada. Border&#244; j&#225; enviado ao Banco!");

UPDATE LANCAMENTOS SET
       COBRANCA=FALSE,
       DESCONTADO=FALSE,
       COD_PORTADOR=NULL,
       GERADOR_PORTADOR=NULL,
       BORDERO=NULL,
       CARTEIRA=NULL,
       TIPO_COBRANCA='C',
       CONTA_COBRANCA=NULL,
       REMESSA = NULL,
       CONTA= CONTA_ORIGEM,
       CONTA_ORIGEM = NULL,
       FILIAL = (SELECT C.FILIAL FROM CONTAS C WHERE CONTA = LANCAMENTOS.CONTA),
       DESCONTADO_FACTORY = FALSE
WHERE (LANCAMENTOS.BORDERO=:BORDERO);

DELETE FROM BORDERO WHERE (BORDERO=:BORDERO);
DELETE FROM BORDERO_LANCAMENTOS WHERE (BORDERO=:BORDERO);
DELETE FROM LANCAMENTOS_COMANDO WHERE (BORDERO=:BORDERO);
DELETE FROM DESC_LANCAMENTO WHERE TIPO_ORIGEM = 'D' AND ORIGEM = :BORDERO;

#EACH() SELECT:LAN LANCAMENTO FROM LANCAMENTOS WHERE TIPO_ORIGEM = 'R' AND ORIGEM = :BORDERO;
     #CALL MILLENIUM.LANCAMENTOS.ExcLancto( LANCAMENTO =:LAN.LANCAMENTO, INTERNO=TRUE );
     
#CALL MILLENIUM.CONTABILIDADE.EXTORNA(tipo_origem="O",origem=:BORDERO,motivo="EXCLUSAO DE BORDERO");
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>