<?xml version="1.0"?>
<root>
  <OBJECT NAME="BORDERO_DESCONTOS">
    <METHOD NAME="Consulta" DESCRIPTION="Consulta de Border&#244;s" VERSION="7" ENABLED="0" INTFTYPE="6" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="BORDERO" FORMAT="+" SIZE="8" FLAGS="1048" PROJECTION="0" FIELDLABEL="Bordero" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP STYLE="1"/>
          <GROUP NAME="Taxa Financeira"/>
          <GROUP NAME="T&#237;tulos" STYLE="1"/>
        </GROUPS>
        <FIELD NAME="BORDERO" FORMAT="+" SIZE="8" FLAGS="1048" PROJECTION="0" FIELDLABEL="Bordero" CTAB="0"/>
        <FIELD NAME="COD_BORDERO" SIZE="20" FLAGS="17" PROJECTION="0" ORDER="3" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <FIELD NAME="DESCRICAO" SIZE="60" FLAGS="17" PROJECTION="0" ORDER="4" FIELDLABEL="Descricao" CTAB="0"/>
        <FIELD NAME="DATA" FORMAT="D" SIZE="10" FLAGS="17" DEFAULT="TODAY" PROJECTION="0" ORDER="2" FIELDLABEL="Data" CTAB="0"/>
        <FIELD NAME="BORDERO_LANCAMENTOS" FORMAT="R" FLAGS="1" STYLE="3" PROJECTION="0" ORDER="16" LOOKUP="BORDERO_DESCONTOS.Seleciona_Titulo" FIELDLABEL="T&#237;tulos" NESTEDNAME="millenium!vestem.BORDERO_DESCONTOS.BORDERO_LANCAMENTOS" GROUPNAME="T&#237;tulos" CTAB="0"/>
        <FIELD NAME="BANCO" FORMAT="N" SIZE="8" FLAGS="17" PROJECTION="0" ORDER="5" LOOKUP="millenium.BANCOS.ListaMeusBancos" LOOKUPKEY="BANCO" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_BANCO" FIELDLABEL="Banco" CTAB="0"/>
        <FIELD NAME="CARTEIRA" FORMAT="N" SIZE="8" FLAGS="17" PROJECTION="0" ORDER="7" LOOKUP="millenium.CARTEIRAS.Lista_Carteiras_bco" LOOKUPKEY="CARTEIRA" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="COD_CARTEIRA" FIELDLABEL="Carteira" CTAB="0"/>
        <FIELD NAME="CONTA" FORMAT="N" SIZE="8" FLAGS="17" PROJECTION="0" ORDER="6" LOOKUP="millenium.CONTAS.Lista_CC" LOOKUPKEY="CONTA" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="NUMERO" FIELDLABEL="Conta" CTAB="0"/>
        <FIELD NAME="ORIGEM" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="9" FIELDLABEL="Nota" CTAB="0"/>
        <FIELD NAME="OBS" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Observa&#231;&#227;o" CTAB="0"/>
        <FIELD NAME="COD_BANCO" SIZE="10" FLAGS="10" PROJECTION="0" FIELDLABEL="Cod Banco" CTAB="0"/>
        <FIELD NAME="CONTROLA_DESCONTADO" FORMAT="B" SIZE="1" FLAGS="10" DEFAULT="1" PROJECTION="0" FIELDLABEL="Controla Descontado" CTAB="0"/>
        <FIELD NAME="BANCO_ADIANTAMENTO" FORMAT="N" SIZE="8" FLAGS="1" VISIBILITYRULE="(CONTROLA_DESCONTADO=TRUE)" PROJECTION="0" ORDER="8" LOOKUP="millenium.BANCOS.ListaBancosAdiantamentos" LOOKUPKEY="BANCO_ADIATAMENTO" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_BANCO_ADIATAMENTO" FIELDLABEL="Banco de adiantamento" CTAB="0"/>
        <FIELD NAME="CONTA_ADIANTAMENTO" FORMAT="N" SIZE="8" FLAGS="1" VISIBILITYRULE="(CONTROLA_DESCONTADO=TRUE)" PROJECTION="0" ORDER="9" LOOKUP="millenium.CONTAS.Lista_CC_Adiantamento" LOOKUPKEY="CONTA_ADIANTAMENTO" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="NUMERO" FIELDLABEL="Conta de adiantamento" CTAB="0"/>
        <FIELD NAME="TAXA_FINANCEIRA" FORMAT="N" SIZE="15" FLAGS="1" DECIMALS="4" VISIBILITYRULE="(CONTROLA_DESCONTADO=TRUE) AND (TAXA_FINANCEIRA_VALOR='')" PROJECTION="0" ORDER="13" FIELDLABEL="Taxa Financeira (%)" GROUPNAME="Taxa Financeira" CTAB="0"/>
        <FIELD NAME="TIPO_PGTO" FORMAT="N" SIZE="8" FLAGS="1" VISIBILITYRULE="(CONTROLA_DESCONTADO=TRUE)" PROJECTION="0" ORDER="10" LOOKUP="millenium.TIPOS_PGTOS.LISTA" LOOKUPKEY="TIPO_PGTO" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Tipo de pagamento" CTAB="0"/>
        <FIELD NAME="TAXA_FINANCEIRA_VALOR" FORMAT="N" SIZE="15" FLAGS="1" DECIMALS="4" VISIBILITYRULE="(CONTROLA_DESCONTADO=TRUE) AND (TAXA_FINANCEIRA='')" PROJECTION="0" ORDER="14" FIELDLABEL="Taxa Financeira (Valor)" GROUPNAME="Taxa Financeira" CTAB="0"/>
        <FIELD NAME="TIPO_BORDERO" FORMAT="N" SIZE="8" FLAGS="129" DEFAULT="0" PROJECTION="0" ORDER="1" LOOKUP="list:'0','CNAB - Contas &#224; Receber';'1','PAGFOR - Contas &#224; Pagar';" FIELDLABEL="Tipo Bordero" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>// IENS DO BORDERO
#SET( BORD_LANC ,{MIN(L.N_DOCUMENTO) AS N_DOCUMENTO,
      (MIN(L.GERADOR) || MIN(L.DESC_GERADOR)) AS DESC_GERADOR, 
       MIN(L.VALOR_INICIAL) AS VALOR_INICIAL, 
       MIN(L.DATA_EMISSAO) AS DATA_EMISSAO,
       MIN(L.DATA_VENCIMENTO) AS DATA_VENCIMENTO, 
       L.LANCAMENTO, BL.BORDERO, 
       MIN(L.COD_PORTADOR) AS COD_PORTADOR,
       MIN(NF.NOTA) as ORIGEM,
       SUM(DL.VALOR) AS DESC_VALOR,
       MIN(L.VALOR_INICIAL) - MIN(#NULL_TO_Z(VL.VAL_DESC)) + MIN(#NULL_TO_Z(VL.VAL_CUST)) AS VALOR_COM_DESC,
       MIN(TP.NATUREZA) AS ESPECIE, MIN(LC.ACAO) AS ACAO

FROM LANCAMENTOS L
INNER JOIN CALC_VAL_LIQ VL ON VL.LANCAMENTO = L.LANCAMENTO
INNER JOIN BORDERO_LANCAMENTOS BL 
      ON L.LANCAMENTO = BL.LANCAMENTO AND BL.BORDERO=:BORDERO
INNER JOIN LANCAMENTOS_COMANDO LC
      ON L.LANCAMENTO = LC.LANCAMENTO AND LC.BORDERO=:BORDERO
INNER JOIN TIPOS_PGTOS TP
      ON TP.TIPO_PGTO = L.TIPO_PGTO
LEFT  JOIN DESC_LANCAMENTO DL
      ON DL.LANCAMENTO = L.LANCAMENTO
      AND DL.DIAS = 9999
LEFT  JOIN NF 
      ON NF.TIPO_OPERACAO = L.TIPO_ORIGEM
      AND NF.COD_OPERACAO  = L.ORIGEM

GROUP BY BL.BORDERO, L.LANCAMENTO
ORDER BY N_DOCUMENTO})

// CARACTERISTICAS DO BORDERO
SELECT B.BORDERO, B.BORDERO as IBORDERO, // Para impedir que mude o tipo de bordero na altera&#231;&#227;o
       B.COD_BORDERO, B.TIPO_BORDERO,
       B.DESCRICAO,B.DATA,
       BCO.BANCO,
       B.CARTEIRA,
       B.CONTA_COBRANCA AS CONTA,
       B.MORA AS MORA,
       B.MULTA AS MULTA,
       B.DIAS_PROTESTO AS DIAS_PROTESTO,
       B.DIAS_PROTESTO AS DIAS_PROTESTO_BB,
       B.DIAS_PROTESTO AS DIAS_PROTESTO_237,
       B.OBS, BO_CHEQUE,
       B.INSTRUCAO1 AS INSTRUCAO1,
       B.INSTRUCAO1 AS INSTRUCAO341,
       B.INSTRUCAO1 AS INSTRUCAO1_237,
       BCO.COD_BANCO,
       B.INSTRUCAO2 AS INSTRUCAO2_001,
       B.INSTRUCAO2 AS INSTRUCAO2_422,
       B.TX_DESCONTO AS TX_DESCONTO,
       B.DD_VCTO_DESCONTO AS DD_VCTO_DESCONTO,
       COBREBEMX.LICENCA,
       B.BANCO_ADIANTAMENTO,
       B.CONTA_ADIANTAMENTO,
       B.TAXA_FINANCEIRA,
       B.TAXA_FINANCEIRA_VALOR,
       B.TIPO_PGTO,
       CO.CONTROLA_DESCONTADO,
       #ROWSET({SELECT:BORDERO_LANCAMENTOS #REPLACE(BORD_LANC) })
       #ROWSET({SELECT:BORDERO_PAGAMENTOS #REPLACE(BORD_LANC) })
FROM BORDERO B
INNER JOIN BANCOS BCO ON B.BANCO = BCO.BANCO
INNER JOIN CONTAS CO  ON CO.CONTA = B.CONTA_COBRANCA
LEFT JOIN COBREBEMX ON B.CARTEIRA=COBREBEMX.CARTEIRA
WHERE BORDERO = :BORDERO;
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>