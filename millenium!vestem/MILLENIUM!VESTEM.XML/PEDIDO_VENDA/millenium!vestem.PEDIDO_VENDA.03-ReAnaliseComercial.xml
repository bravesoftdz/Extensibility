<?xml version="1.0"?>
<root>
  <OBJECT NAME="PEDIDO_VENDA">
    <METHOD NAME="03-ReAnaliseComercial" DESCRIPTION="Re-An&#225;lise - Comercial" VERSION="87" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP NAME="Dados do Pedido"/>
          <GROUP NAME="Aprova&#231;&#227;o"/>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="PEDIDOV" FORMAT="N" SIZE="8" FLAGS="130" PROJECTION="0" FIELDLABEL="Pedidov" CTAB="0"/>
        <PARAM NAME="COD_PEDIDOV" SIZE="20" FLAGS="131" PROJECTION="0" ORDER="1" FIELDLABEL="Codigo do Pedido" GROUPNAME="Dados do Pedido" CTAB="0"/>
        <PARAM NAME="STATUS_WORKFLOW" FORMAT="N" SIZE="8" FLAGS="131" PROJECTION="0" ORDER="4" LOOKUP="MILLENIUM.STATUS_WORKFLOW.LISTA" LOOKUPKEY="STATUS_WORKFLOW" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Status atual no Workflow" GROUPNAME="Dados do Pedido" CTAB="0"/>
        <PARAM NAME="OBS" FLAGS="131" PROJECTION="0" ORDER="5" FIELDLABEL="Observa&#231;&#227;o do pedido" GROUPNAME="Dados do Pedido" CTAB="0"/>
        <PARAM NAME="OPCAO" FORMAT="N" SIZE="1" FLAGS="17" PROJECTION="0" ORDER="7" LOOKUP="list:'1','Aprovado';'2','Reprovado';" FIELDLABEL="Status" GROUPNAME="Aprova&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="OBS_APROVACAO" SIZE="100" FLAGS="1" VISIBILITYRULE="OPCAO &lt;> 2" PROJECTION="0" ORDER="8" FIELDLABEL="Observa&#231;&#227;o" GROUPNAME="Aprova&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="OBS_CANC" FORMAT="N" SIZE="8" FLAGS="1" VISIBILITYRULE="OPCAO = 2" PROJECTION="0" ORDER="9" LOOKUP="MILLENIUM.OBS_CANC.Listar" LOOKUPKEY="OBS_CANC" LOOKUPDISPLAY="OBS" LOOKUPCODE="COD_OBS_CANC" FIELDLABEL="Motivo do Cancelamento" GROUPNAME="Aprova&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="MOTIVO" SIZE="100" FLAGS="1" VISIBILITYRULE="OPCAO = 2" PROJECTION="0" ORDER="10" FIELDLABEL="Observa&#231;&#227;o Cancelamento" GROUPNAME="Aprova&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="COND_PGTO" SIZE="30" FLAGS="131" PROJECTION="0" ORDER="2" FIELDLABEL="Condi&#231;&#227;o de Pagamento" GROUPNAME="Dados do Pedido" CTAB="0"/>
        <PARAM NAME="TOTAL_AENTREGAR" FORMAT="M" SIZE="17" FLAGS="131" DECIMALS="4" PROJECTION="0" ORDER="3" FIELDLABEL="Valor Total &#224; Entregar" GROUPNAME="Dados do Pedido" CTAB="0"/>
      </PARAMS>
      <FIELDS/>
      <ACTIONSCRIPT>
#CHECK("SELECT COUNT(*) AS N FROM PEDIDO_VENDA PV WHERE (PV.PEDIDOV=:PEDIDOV) AND PV.STATUS_WORKFLOW = 4", N=0, "O pedido n&#227;o est&#225; com o status RE-ANALISE COMERCIAL !");

#SELECT(OPCAO,
  1:{
     #CALL MILLENIUM.PEDIDO_VENDA.LOG_GRAVAR(PEDIDOV=:PEDIDOV, DESCRICAO=:OBS_APROVACAO);
     #CALL MILLENIUM!VESTEM.PEDIDO_VENDA.EV_REANALISE_COMERCIAL(:PEDIDOV);
     UPDATE PEDIDO_VENDA PV SET PV.EVL_REANALISE_COMERCIAL  = :OPCAO, PV.STATUS_WORKFLOW = 3 WHERE PV.PEDIDOV=:PEDIDOV;
  },

  2:{#CALL MILLENIUM.PEDIDO_VENDA.INCLUIR_MOTIVO(
       PEDIDOV=:PEDIDOV,
       MOTIVO=:MOTIVO,
       OBS_CANC=:OBS_CANC,
       FORCA=TRUE,
       EXCLUI_PREFATURAMENTO=TRUE,
       FORCA_ECOMMERCE=TRUE,
       REMOVER_LANCAMENTO_BORDERO=TRUE
       );

     #CALL MILLENIUM.PEDIDO_VENDA.LOG_GRAVAR(PEDIDOV=:PEDIDOV, DESCRICAO=:OBS_APROVACAO);
     #CALL MILLENIUM!VESTEM.PEDIDO_VENDA.EV_REANALISE_COMERCIAL(:PEDIDOV);
     UPDATE PEDIDO_VENDA PV SET PV.EVL_REANALISE_COMERCIAL = :OPCAO, PV.STATUS_WORKFLOW = 1 WHERE PV.PEDIDOV=:PEDIDOV;
  },

  ELSE:{}
);


</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>