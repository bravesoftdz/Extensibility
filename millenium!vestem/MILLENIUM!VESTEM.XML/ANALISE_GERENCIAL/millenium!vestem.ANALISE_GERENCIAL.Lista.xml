<?xml version="1.0"?>
<root>
  <OBJECT NAME="ANALISE_GERENCIAL">
    <METHOD NAME="Lista" DESCRIPTION="Analise Gerencial Financeira - Vestem" VERSION="36" INTFTYPE="14" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="DATAI" FORMAT="D" SIZE="10" FLAGS="17" DEFAULT="TODAY" PROJECTION="0" ORDER="2" FIELDLABEL="Data Inicial" CTAB="0"/>
        <PARAM NAME="DATAF" FORMAT="D" SIZE="10" FLAGS="17" DEFAULT="TODAY" PROJECTION="0" ORDER="3" FIELDLABEL="Data Final" CTAB="0"/>
        <PARAM NAME="FILIAIS" SIZE="1000" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="4" LOOKUP="millenium.FILIAIS.LISTA_SIMPLES" LOOKUPKEY="FILIAL" LOOKUPDISPLAY="FANTASIA" LOOKUPCODE="COD_FILIAL" FIELDLABEL="Empresa" CTAB="0"/>
        <PARAM NAME="VISAO" SIZE="1" FLAGS="1" DEFAULT="1" PROJECTION="0" ORDER="1" LOOKUP="list:'1','Diario';'2','Semanal';'3','Mensal';'4','Anual';" FIELDLABEL="Vis&#227;o" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="DATA" FORMAT="D" SIZE="10" FLAGS="8" PROJECTION="0" ORDER="7" FIELDLABEL="Data" CTAB="0"/>
        <FIELD NAME="DIA" FORMAT="N" SIZE="2" PROJECTION="0" ORDER="7" FIELDLABEL="Dia" CTAB="0"/>
        <FIELD NAME="MES" FORMAT="N" SIZE="2" PROJECTION="0" ORDER="9" FIELDLABEL="Mes" CTAB="0"/>
        <FIELD NAME="ANO" FORMAT="N" SIZE="4" PROJECTION="0" ORDER="11" FIELDLABEL="Ano" CTAB="0"/>
        <FIELD NAME="NDIASEMANA" SIZE="20" PROJECTION="0" ORDER="8" FIELDLABEL="Dia da Semana" CTAB="0"/>
        <FIELD NAME="NMES" SIZE="10" PROJECTION="0" ORDER="10" FIELDLABEL="Nome M&#234;s" CTAB="0"/>
        <FIELD NAME="PCONTA" FORMAT="N" SIZE="8" FLAGS="8" PROJECTION="0" ORDER="12" FIELDLABEL="Pconta" CTAB="0"/>
        <FIELD NAME="DESC_PLANO_CONTA" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Plano Conta" CTAB="0"/>
        <FIELD NAME="VALOR_ORCADO" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="9" FIELDLABEL="Valor Or&#231;ado" CTAB="0"/>
        <FIELD NAME="VALOR_PREVISTO" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="10" FIELDLABEL="Valor Previsto" CTAB="0"/>
        <FIELD NAME="VALOR_EFETIVO" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="11" FIELDLABEL="Valor Efetivo" CTAB="0"/>
        <FIELD NAME="VALOR_REALIZADO" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="12" FIELDLABEL="Valor Realizado" CTAB="0"/>
        <FIELD NAME="VISAO" SIZE="20" FLAGS="9" PROJECTION="0" ORDER="6" FIELDLABEL="Vis&#227;o" CTAB="0"/>
        <FIELD NAME="DESC_CONTA_DRE" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Conta Dre" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT


  #select(VISAO, 1:{D.DATA},
                 2:{D.NDIASEMANA},
                 3:{D.NMES},
                 4:{D.ANO},
                 else:{D.DATA}) AS VISAO
//   D.DATA
//  ,D.DIA
//  ,D.MES
//  ,D.ANO
//  ,D.NDIASEMANA
//  ,D.NMES
  ,PC.PCONTA
  ,MIN(PC.CLASSIFICACAO)||' - '||MIN(PC.DESCRICAO) AS DESC_PLANO_CONTA
 ,MIN(CD.DESCRICAO) AS DESC_CONTA_DRE
  //,L.LANCAMENTO
  //,L.N_DOCUMENTO
  //,MIN(L.DESC_GERADOR)  AS DESC_GERADOR

  ,((SELECT SUM(PVC.VALOR) FROM PREVISOES_CONTABEIS PV
       INNER JOIN PREVISOES_CONTAS PVC ON PVC.PREVISAO_CONTABIL = PV.PREVISAO_CONTABIL
     WHERE D.DATA >= PV.DATAI AND D.DATA &lt;= PV.DATAF
       AND PVC.PCONTA = PC.PCONTA
  )) AS VALOR_ORCADO
  ,0 AS VALOR_PREVISTO
  ,SUM(L.VALOR_INICIAL) AS VALOR_EFETIVO
  ,0 AS VALOR_REALIZADO
FROM DATAS D
  LEFT JOIN LANCAMENTOS    L  ON L.DATA_VENCIMENTO = D.DATA
  LEFT JOIN PLANO_CONTAS   PC ON PC.PCONTA = L.PCONTA
  LEFT JOIN CONTA_CONTABIL CC ON CC.CONTA_CONTABIL = PC.PCONTA
  LEFT JOIN CONTA_DRE      CD ON CD.CONTA_DRE = CC.CONTA_DRE
WHERE D.DATA BETWEEN :DATAI AND :DATAF
  [AND L.FILIAL IN #REPLACE ( FILIAIS )]
//AND L.EFETUADO = 'T'
//AND L.TIPO = 'P'

GROUP BY
  #select(VISAO, 1:{D.DATA},
                 2:{D.NDIASEMANA},
                 3:{D.NMES},
                 4:{D.ANO},
                 else:{D.DATA})
    ,PC.PCONTA
                 
                 
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>