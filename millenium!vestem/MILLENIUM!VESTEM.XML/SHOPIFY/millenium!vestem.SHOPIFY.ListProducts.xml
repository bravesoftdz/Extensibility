<?xml version="1.0"?>
<root>
  <OBJECT NAME="SHOPIFY">
    <METHOD NAME="ListProducts" DESCRIPTION="" VERSION="56" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="CLIENTE" FORMAT="N" SIZE="8" FLAGS="1" STYLE="5" PROJECTION="0" ORDER="1" LOOKUP="MILLENIUM.CLIENTES.Lista_FiltroPopup" LOOKUPKEY="CLIENTE" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_CLIENTE" FIELDLABEL="Cliente" CTAB="0"/>
        <PARAM NAME="NOTAI" FORMAT="N" SIZE="12" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="Nota Inicial" CTAB="0"/>
        <PARAM NAME="DATAI" FORMAT="D" SIZE="10" FLAGS="1" DEFAULT="TODAY-30" PROJECTION="0" ORDER="2" FIELDLABEL="Data Inicial" CTAB="0"/>
        <PARAM NAME="DATAF" FORMAT="D" SIZE="10" FLAGS="1" DEFAULT="TODAY" PROJECTION="0" ORDER="3" FIELDLABEL="Data Final" CTAB="0"/>
        <PARAM NAME="NOTAF" FORMAT="N" SIZE="12" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Nota Final" CTAB="0"/>
        <PARAM NAME="TABELA_PRECO" FORMAT="N" SIZE="8" FLAGS="17" PROJECTION="0" ORDER="6" LOOKUP="MILLENIUM.TABELAS_PRECO.LISTA_TABELAS" LOOKUPKEY="TABELA" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="COD_TPRECO" FIELDLABEL="Tabela de Pre&#231;o" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="SKU" SIZE="30" PROJECTION="0" ORDER="7" FIELDLABEL="Sku" CTAB="0"/>
        <FIELD NAME="HANDLE" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Handle" CTAB="0"/>
        <FIELD NAME="TITLE" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Title" CTAB="0"/>
        <FIELD NAME="BODY_HTML" SIZE="255" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Body Html" CTAB="0"/>
        <FIELD NAME="VENDOR" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Vendor" CTAB="0"/>
        <FIELD NAME="TYPE" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Type" CTAB="0"/>
        <FIELD NAME="TAGS" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="Tags" CTAB="0"/>
        <FIELD NAME="PUBLISHED" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="14" FIELDLABEL="Published" CTAB="0"/>
        <FIELD NAME="OPTION1_NAME" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="15" FIELDLABEL="Option1 Name" CTAB="0"/>
        <FIELD NAME="OPTION1_VALUE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="16" FIELDLABEL="Option1 Value" CTAB="0"/>
        <FIELD NAME="OPTION2_NAME" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="17" FIELDLABEL="Option2 Name" CTAB="0"/>
        <FIELD NAME="OPTION2_VALUE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="18" FIELDLABEL="Option2 Value" CTAB="0"/>
        <FIELD NAME="OPTION3_NAME" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="19" FIELDLABEL="Option3 Name" CTAB="0"/>
        <FIELD NAME="OPTION3_VALUE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="20" FIELDLABEL="Option3 Value" CTAB="0"/>
        <FIELD NAME="VARIANT_SKU" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="21" FIELDLABEL="Variant Sku" CTAB="0"/>
        <FIELD NAME="VARIANT_GRAMS" FORMAT="N" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="22" FIELDLABEL="Variant Grams" CTAB="0"/>
        <FIELD NAME="VARIANT_INVENTORY_TRACKER" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="23" FIELDLABEL="Variant Inventory Tracker" CTAB="0"/>
        <FIELD NAME="VARIANT_INVENTORY_QTY" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="24" FIELDLABEL="Variant Inventory Qty" CTAB="0"/>
        <FIELD NAME="VARIANT_INVENTORY_POLICY" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="25" FIELDLABEL="Variant Inventory Policy" CTAB="0"/>
        <FIELD NAME="VARIANT_FULFILLMENT_SERVICE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="26" FIELDLABEL="Variant Fulfillment Service" CTAB="0"/>
        <FIELD NAME="VARIANT_PRICE" FORMAT="N" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="27" FIELDLABEL="Variant Price" CTAB="0"/>
        <FIELD NAME="VARIANT_COMPARE_AT_PRICE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="28" FIELDLABEL="Variant Compare At Price" CTAB="0"/>
        <FIELD NAME="VARIANT_REQUIRE_SHIPPING" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="29" FIELDLABEL="Variant Require Shipping" CTAB="0"/>
        <FIELD NAME="VARIANT_TAXABLE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="30" FIELDLABEL="Variant Taxable" CTAB="0"/>
        <FIELD NAME="VARIANT_BARCODE" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="31" FIELDLABEL="Variant Barcode" CTAB="0"/>
        <FIELD NAME="IMAGE_SRC" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="32" FIELDLABEL="Image Src" CTAB="0"/>
        <FIELD NAME="IMAGE_POSITION" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="33" FIELDLABEL="Image Position" CTAB="0"/>
        <FIELD NAME="IMAGE_ALT_TEXT" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="34" FIELDLABEL="Image Alt Text" CTAB="0"/>
        <FIELD NAME="GIFT_CARD" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="35" FIELDLABEL="Gift Card" CTAB="0"/>
        <FIELD NAME="SEO_TITLE" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="36" FIELDLABEL="Seo Title" CTAB="0"/>
        <FIELD NAME="SEO_DESCRIPTION" SIZE="255" FLAGS="1" PROJECTION="0" ORDER="37" FIELDLABEL="Seo Description" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_GOOGLE_PRODUCT_CATEGORY" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="38" FIELDLABEL="Google Shopping / Google Product Category" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_GENDER" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="39" FIELDLABEL="Google Shopping / Gender" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_AGE_GROUP" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="40" FIELDLABEL="Google Shopping / Age Group" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_MPN" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="41" FIELDLABEL="Google Shopping / MPN" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_ADWORDS_GROUPING" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="42" FIELDLABEL="Google Shopping / Adwords Grouping" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_ADWORDS_LABELS" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="43" FIELDLABEL="Google Shopping / Adwords Labels" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_CONDITION" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="44" FIELDLABEL="Google Shopping / Condition" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_CUSTOM_PRODUCT" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="50" FIELDLABEL="Google Shopping / Custom Product" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_CUSTOM_LABEL_0" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="45" FIELDLABEL="Google Shopping / Custom Label 0" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_CUSTOM_LABEL_1" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="46" FIELDLABEL="Google Shopping / Custom Label 1" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_CUSTOM_LABEL_2" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="47" FIELDLABEL="Google Shopping / Custom Label 2" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_CUSTOM_LABEL_3" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="48" FIELDLABEL="Google Shopping / Custom Label 3" CTAB="0"/>
        <FIELD NAME="GOOGLE_SHOPPING_CUSTOM_LABEL_4" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="49" FIELDLABEL="Google Shopping / Custom Label 4" CTAB="0"/>
        <FIELD NAME="VARIANT_IMAGE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="51" FIELDLABEL="Variant Image" CTAB="0"/>
        <FIELD NAME="VARIANT_WEIGHT_UNIT" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="52" FIELDLABEL="Variant Weight Unit" CTAB="0"/>
        <FIELD NAME="VARIANT_TAX_CODE" SIZE="10" FLAGS="1" PROJECTION="0" ORDER="53" FIELDLABEL="Variant Tax Code" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT
   SKU.PRODUTO||'_'||SKU.COR||'_'||SKU.ESTAMPA||'_'||SKU.TAMANHO AS SKU
  ,REPLACE(MIN(P.DESCRICAO1),' ', '-')  AS HANDLE
  ,MIN(P.DESCRICAO1)                    AS TITLE
  ,MIN(P.OBS)||'&lt;BR/>&lt;BR/>Color: '||LOWER(MIN(C.DESCRICAO)) ||' Composition:' ||LOWER(MIN(C.DESCRICAO))  AS BODY_HTML
  ,'Vestem'           AS VENDOR
  ,MIN(TP.DESCRICAO)  AS TYPE
  ,MIN(UPPER(C.DESCRICAO)) ||' , ' ||MIN(UPPER(G.DESCRICAO))||' , ' ||MIN(UPPER(TP.DESCRICAO))            AS TAGS
  ,'FALSE'            AS PUBLISHED
  ,'Size'             AS OPTION1_NAME
  ,MIN(SKU.TAMANHO)   AS OPTION1_VALUE
  ,NULL               AS OPTION2_NAME
  ,NULL               AS OPTION2_VALUE
  ,NULL               AS OPTION3_NAME
  ,NULL               AS OPTION3_VALUE
  ,MIN(P.COD_PRODUTO) AS VARIANT_SKU
  ,MIN(P.PESO*1000)   AS VARIANT_GRAMS
  ,'shopify'          AS VARIANT_INVENTORY_TRACKER
  ,SUM(PE.QUANTIDADE) AS VARIANT_INVENTORY_QTY
  ,'deny'             AS VARIANT_INVENTORY_POLICY
  ,'manual'           AS VARIANT_FULFILLMENT_SERVICE
  ,MIN((SELECT MAX(PR.PRECO)
           FROM PRECOS PR WHERE  PR.PRODUTO = SKU.PRODUTO
                          AND PR.COR     = SKU.COR
                          AND PR.TAMANHO = SKU.TAMANHO
                          AND PR.ESTAMPA = SKU.ESTAMPA
                          AND PR.TABELA  = :TABELA_PRECO
                          )) AS VARIANT_PRICE
  
  ,NULL               AS VARIANT_COMPARE_AT_PRICE
  ,'VERDADEIRO'       AS VARIANT_REQUIRE_SHIPPING
  ,'VERDADEIRO'       AS VARIANT_TAXABLE
  //,MIN(CB.BARRA)      AS VARIANT_BARCODE
  ,MIN(CB.BARRA),1,12)||EAN13CS(SUBSTR(MIN(CB.BARRA),1,12))AS VARIANT_BARCODE
  ,'http://img.vestem.link/'||MIN(P.COD_PRODUTO)||'_'||MIN(C.COD_COR)||'_1.JPG' AS IMAGE_SRC
  ,1                  AS IMAGE_POSITION
  ,MIN(P.DESCRICAO1)  AS IMAGE_ALT_TEXT
  ,'FALSO'            AS GIFT_CARD
  ,MIN(P.DESCRICAO1)  AS SEO_TITLE
  ,MIN(P.OBS)||'&lt;BR/>&lt;BR/>Color: '||LOWER(MIN(C.DESCRICAO)) ||' Composition:' ||Lower(min(c.descricao))   AS SEO_DESCRIPTION
  ,NULL               AS GOOGLE_SHOPPING_GOOGLE_PRODUCT_CATEGORY
  ,NULL               AS GOOGLE_SHOPPING_GENDER
  ,NULL               AS GOOGLE_SHOPPING_AGE_GROUP
  ,NULL               AS GOOGLE_SHOPPING_MPN
  ,NULL               AS GOOGLE_SHOPPING_ADWORDS_GROUPING
  ,NULL               AS GOOGLE_SHOPPING_ADWORDS_LABELS
  ,NULL               AS GOOGLE_SHOPPING_CONDITION
  ,NULL               AS GOOGLE_SHOPPING_CUSTOM_PRODUCT
  ,NULL               AS GOOGLE_SHOPPING_CUSTOM_LABEL_0
  ,NULL               AS GOOGLE_SHOPPING_CUSTOM_LABEL_1
  ,NULL               AS GOOGLE_SHOPPING_CUSTOM_LABEL_2
  ,NULL               AS GOOGLE_SHOPPING_CUSTOM_LABEL_3
  ,NULL               AS GOOGLE_SHOPPING_CUSTOM_LABEL_4
  ,NULL               AS VARIANT_IMAGE
  ,NULL               AS VARIANT_WEIGHT_UNIT
  ,NULL               AS VARIANT_TAX_CODE
  
FROM PRODUTO_SKU SKU
  INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
  INNER JOIN CORES C ON C.COR = SKU.COR
  INNER JOIN ESPEC_PRODUTOS EP ON EP.PRODUTO = SKU.PRODUTO
  INNER JOIN ESPECIFICACOES ESP ON ESP.ESPECIFICACAO = EP.ESPECIFICACAO
  INNER JOIN TIPOS  TP ON TP.TIPO = P.TIPO
  INNER JOIN GRUPOS G  ON G.GRUPO = P.GRUPO
  INNER JOIN CODIGO_BARRAS CB ON CB.PRODUTO = P.PRODUTO
                         AND CB.COR         = SKU.COR
                         AND CB.ESTAMPA     = SKU.ESTAMPA
                         AND CB.TAMANHO     = SKU.TAMANHO
                         AND CB.QUANTIDADE  = 1

  INNER JOIN PRODUTOS_EVENTOS PE ON PE.PRODUTO = P.PRODUTO
                         AND PE.COR            = SKU.COR
                         AND PE.ESTAMPA        = SKU.ESTAMPA
                         AND PE.TAMANHO        = SKU.TAMANHO

 INNER JOIN MOVIMENTO M ON M.COD_OPERACAO = PE.COD_OPERACAO AND M.TIPO_OPERACAO = PE.TIPO_OPERACAO
 INNER JOIN NF        N ON N.COD_OPERACAO = PE.COD_OPERACAO AND N.TIPO_OPERACAO = PE.TIPO_OPERACAO

WHERE P.TIPO_PROD = 'AC'
  //AND P.COD_PRODUTO = '001077'
   AND M.CANCELADA = 'F'
  [AND M.CLIENTE =:CLIENTE]
  [AND M.DATA BETWEEN :DATAI AND :DATAF]
  [AND N.NOTA BETWEEN :NOTAI AND :NOTAF]

GROUP BY 1
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>