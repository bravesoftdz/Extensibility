<?xml version="1.0"?>
<root>
  <OBJECT NAME="B2B">
    <METHOD NAME="ListaTabelasPreco" DESCRIPTION="Lista Tabela de Pre&#231;os" VERSION="84" INTFTYPE="5" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="ORDEM" FORMAT="N" SIZE="1" FLAGS="1" DEFAULT="1" PROJECTION="0" HINT="Campo correspondente a ordem&lt;b>(0=Descri&#231;&#227;o,1= C&#243;digo)&lt;/b>." ORDER="7" LOOKUP="list:'0','DESCRI&#199;&#195;O';'1','C&#211;DIGO';" FIELDLABEL="Ordem" CTAB="0"/>
        <PARAM NAME="TABCUSTO" FORMAT="B" SIZE="1" FLAGS="1" DEFAULT="0" PROJECTION="0" HINT="Campo que indica que marca somente tabelas de custo." ORDER="5" FIELDLABEL="Tabela de Custo" CTAB="0"/>
        <PARAM NAME="PRODUTO1" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="!Produto" ORDER="4" FIELDLABEL="Produto" CTAB="0"/>
        <PARAM NAME="FORNECEDOR" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="!Fornecedor" ORDER="2" FIELDLABEL="Fornecedor" CTAB="0"/>
        <PARAM NAME="MOEDA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="!Moeda" ORDER="3" FIELDLABEL="Moeda" CTAB="0"/>
        <PARAM NAME="TIPOS_TABELAS" SIZE="1" FLAGS="1" DEFAULT="0" PROJECTION="0" HINT="!0 = Normal, 1 = Virtual, 2 = Ambas" ORDER="6" LOOKUP="list:'0','Normal';'1','Virtual';'2','Ambas';" FIELDLABEL="Tipo Tabela" CTAB="0"/>
        <PARAM NAME="COD_TPRECO" SIZE="5" FLAGS="1" PROJECTION="0" HINT="Campo correspondente ao c&#243;digo da tabela de pre&#231;os." ORDER="1" FIELDLABEL="Cod Tpreco" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="TABELA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Id da tabela de pre&#231;os" ORDER="9" FIELDLABEL="Tabela" CTAB="0"/>
        <FIELD NAME="COD_TPRECO" SIZE="7" FLAGS="1" PROJECTION="0" HINT="C&#243;digo da tabela de pre&#231;os" ORDER="10" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <FIELD NAME="DESCRICAO" SIZE="40" FLAGS="1" PROJECTION="0" HINT="Descri&#231;&#227;o da tabela de pre&#231;os" ORDER="11" FIELDLABEL="Descri&#231;&#227;o" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT TABELA, COD_TPRECO, DESCRICAO
FROM #VIEW(
     SELECT t.TABELA, t.COD_TPRECO, t.DESCRICAO, t.TABCUSTO, f.FILIAL, t.MOEDA, t.FORNECEDOR, t.TIPO_TABELA
       FROM TABELAS_PRECO t INNER JOIN FILIAIS f ON (1=1)
      WHERE not EXISTS (SELECT * FROM TAB_PRECOXFILIAL x
            WHERE f.FILIAL = x.FILIAL and t.TABCUSTO=x.TABCUSTO)
      UNION ALL
     SELECT t.TABELA, t.COD_TPRECO, t.DESCRICAO, t.TABCUSTO, f.FILIAL, t.MOEDA, t.FORNECEDOR, t.TIPO_TABELA
       FROM TABELAS_PRECO t INNER JOIN TAB_PRECOXFILIAL f ON (
            f.TABELA_PRECO = t.TABELA and t.TABCUSTO=t.TABCUSTO))
WHERE  TABCUSTO = 'F'
      [AND MOEDA=:MOEDA]
      [AND COD_TPRECO=:COD_TPRECO]
      #SELECT(((TIPOS_TABELAS=2) OR (TIPOS_TABELAS=NULL)),TRUE:{},ELSE:{
      [AND TIPO_TABELA=:TIPOS_TABELAS]})
      #SELECT(TABCUSTO,TRUE:{ [AND (FORNECEDOR=:FORNECEDOR OR FORNECEDOR IS NULL)] },ELSE:{})
      #SELECT(PRODUTO1,NULL:{},ELSE:{
      AND (TIPO_TABELA='1' OR TABELA
      IN (SELECT DISTINCT TABELA FROM PRECOS
      WHERE PRODUTO = #REPLACE(:PRODUTO1)))})
      AND DESCRICAO NOT LIKE 'Z%'
      and tabela in (1,55,1000007)
GROUP BY TABELA, COD_TPRECO, DESCRICAO
ORDER BY #SELECT(ORDEM,0:DESCRICAO, ELSE:COD_TPRECO)
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>