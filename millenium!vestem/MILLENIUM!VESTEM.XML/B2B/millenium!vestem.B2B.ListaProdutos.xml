<?xml version="1.0"?>
<root>
  <OBJECT NAME="B2B">
    <METHOD NAME="ListaProdutos" DESCRIPTION="Lista produtos sem associa&#231;&#227;o a vitrine" VERSION="126" INTFTYPE="5" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="PRODUTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Campo correspondente ao produto." ORDER="11" FIELDLABEL="Produto" CTAB="0"/>
        <PARAM NAME="TABELA1" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Campo correspondente a tabela de pre&#231;o 1." ORDER="8" FIELDLABEL="Tabela" CTAB="0"/>
        <PARAM NAME="TABELA2" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Campo correspondente a tabela de pre&#231;o 2." ORDER="7" FIELDLABEL="Pedidov" CTAB="0"/>
        <PARAM NAME="FILIAL" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Campo correspondente a filial." ORDER="9" FIELDLABEL="Tabela2" CTAB="0"/>
        <PARAM NAME="PEDIDOV" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Campo correspondente ao id do pedido de venda." ORDER="6" FIELDLABEL="Empresa" CTAB="0"/>
        <PARAM NAME="DATA_ATUALIZACAO_INICIAL" FORMAT="D" SIZE="10" FLAGS="1" PROJECTION="0" HINT="Campo correspondente a data de atualiza&#231;&#227;o inicial." ORDER="5" FIELDLABEL="Data Atualizacao Inicial" CTAB="0"/>
        <PARAM NAME="WEB" SIZE="1" FLAGS="1" DEFAULT="T" PROJECTION="0" HINT="Campo correspondente a WEB&lt;b>(F=Indispon&#237;vel na WEB,T=Dispon&#237;vel na WEB,E=Excluir da WEB)&lt;/b>." ORDER="10" LOOKUP="list:'F','Indispon&#237;vel na WEB';'T','Dispon&#237;vel na WEB';'E','Excluir da WEB';" FIELDLABEL="Web" CTAB="0"/>
        <PARAM NAME="DIVISAO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Campo correspondente a divis&#227;o." ORDER="3" FIELDLABEL="Divisao" CTAB="0"/>
        <PARAM NAME="MARCA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" HINT="Campo correspondente a marca." ORDER="4" FIELDLABEL="Marca" CTAB="0"/>
        <PARAM NAME="COLECOES" SIZE="200" FLAGS="1" PROJECTION="0" HINT="Campo correspondente a cole&#231;&#227;o." ORDER="1" FIELDLABEL="Colecoes" CTAB="0"/>
        <PARAM NAME="COD_PRODUTO" SIZE="60" PROJECTION="0" HINT="Campo correspondente ao c&#243;digo do produto." FIELDLABEL="Cod Produto" CTAB="0"/>
        <PARAM NAME="TRANS_ID" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Trans Id" CTAB="0"/>
        <PARAM NAME="TOP" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Top" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="PRODUTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="50" FIELDLABEL="Produto" CTAB="0"/>
        <FIELD NAME="DESCRICAO1" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="52" FIELDLABEL="Descricao1" CTAB="0"/>
        <FIELD NAME="COD_PRODUTO" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="48" FIELDLABEL="cod_Produto" CTAB="0"/>
        <FIELD NAME="TIPO_PROD" SIZE="2" FLAGS="1" PROJECTION="0" HINT="AC = Produto acabado, MP = Mat&#233;ria prima, MC = Material de consumo" ORDER="51" FIELDLABEL="tipo_prod" CTAB="0"/>
        <FIELD NAME="DESCRICAO2" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="53" FIELDLABEL="Descricao2" CTAB="0"/>
        <FIELD NAME="DESCRICAO_TRADUZIDA" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="54" FIELDLABEL="descricao_traduzida" CTAB="0"/>
        <FIELD NAME="DESCRICAO_LITERAL" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="43" FIELDLABEL="Descricao Literal" CTAB="0"/>
        <FIELD NAME="DESCRICAO_ETIQ" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="42" FIELDLABEL="Descricao Etiq" CTAB="0"/>
        <FIELD NAME="DESCRICAO_ORIGINAL" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="44" FIELDLABEL="Descricao Original" CTAB="0"/>
        <FIELD NAME="DESCRICAO_SF" SIZE="100" FLAGS="1" PROJECTION="0" ORDER="45" FIELDLABEL="Descricao Sf" CTAB="0"/>
        <FIELD NAME="GRADE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="35" FIELDLABEL="Grade" CTAB="0"/>
        <FIELD NAME="SKU" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="46" FIELDLABEL="Sku" NESTEDNAME="millenium_eco.PRODUTOS.SKU" CTAB="0"/>
        <FIELD NAME="TAMANHOS" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="47" FIELDLABEL="Tamanhos" NESTEDNAME="millenium_eco.PRODUTOS.TAMANHOS" CTAB="0"/>
        <FIELD NAME="ESTAMPAS" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="49" FIELDLABEL="Estampas" NESTEDNAME="millenium_eco.PRODUTOS.ESTAMPAS" CTAB="0"/>
        <FIELD NAME="CORES" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="55" FIELDLABEL="Cores" NESTEDNAME="millenium_eco.PRODUTOS.CORES" CTAB="0"/>
        <FIELD NAME="WEB" SIZE="1" FLAGS="1" PROJECTION="0" HINT="T = Indispon&#237;vel na WEB, F = Indispon&#237;vel na WEB, E = Excluir da WEB" ORDER="41" FIELDLABEL="Web" CTAB="0"/>
        <FIELD NAME="COLECAO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="26" FIELDLABEL="Colecao" CTAB="0"/>
        <FIELD NAME="DEPARTAMENTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="27" FIELDLABEL="Departamento" CTAB="0"/>
        <FIELD NAME="DIVISAO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="34" FIELDLABEL="Divisao" CTAB="0"/>
        <FIELD NAME="GRUPO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="36" FIELDLABEL="Grupo" CTAB="0"/>
        <FIELD NAME="MARCA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="37" FIELDLABEL="Marca" CTAB="0"/>
        <FIELD NAME="TIPO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="40" FIELDLABEL="Tipo" CTAB="0"/>
        <FIELD NAME="COD_COLECAO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="20" FIELDLABEL="Cod Colecao" CTAB="0"/>
        <FIELD NAME="DESC_COLECAO" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="28" FIELDLABEL="Desc Colecao" CTAB="0"/>
        <FIELD NAME="COD_DEPARTAMENTO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="21" FIELDLABEL="Cod Departamento" CTAB="0"/>
        <FIELD NAME="DESC_DEPARTAMENTO" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="29" FIELDLABEL="Desc Departamento" CTAB="0"/>
        <FIELD NAME="COD_DIVISAO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="22" FIELDLABEL="Cod Divisao" CTAB="0"/>
        <FIELD NAME="DESC_DIVISAO" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="30" FIELDLABEL="Desc Divisao" CTAB="0"/>
        <FIELD NAME="COD_GRUPO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="23" FIELDLABEL="Cod Grupo" CTAB="0"/>
        <FIELD NAME="DESC_GRUPO" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="31" FIELDLABEL="Desc Grupo" CTAB="0"/>
        <FIELD NAME="COD_MARCA" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="24" FIELDLABEL="Cod Marca" CTAB="0"/>
        <FIELD NAME="DESC_MARCA" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="32" FIELDLABEL="Desc Marca" CTAB="0"/>
        <FIELD NAME="COD_TIPO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="25" FIELDLABEL="Cod Tipo" CTAB="0"/>
        <FIELD NAME="DESC_TIPO" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="33" FIELDLABEL="Desc Tipo" CTAB="0"/>
        <FIELD NAME="OBS" FLAGS="1" PROJECTION="0" ORDER="38" FIELDLABEL="Obs" CTAB="0"/>
        <FIELD NAME="SUBCOLECAO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="39" FIELDLABEL="Subcolecao" CTAB="0"/>
        <FIELD NAME="COD_SUBCOLECAO" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="19" FIELDLABEL="Subcolecao" CTAB="0"/>
        <FIELD NAME="DESC_SUBCOLECAO" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="18" FIELDLABEL="Desc Subcolecao" CTAB="0"/>
        <FIELD NAME="CATEGORIA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="14" FIELDLABEL="Categoria" CTAB="0"/>
        <FIELD NAME="COD_CATEGORIA" SIZE="15" FLAGS="1" PROJECTION="0" ORDER="15" FIELDLABEL="Cod Categoria" CTAB="0"/>
        <FIELD NAME="DESC_CATEGORIA" SIZE="150" FLAGS="1" PROJECTION="0" ORDER="17" FIELDLABEL="Desc Categoria" CTAB="0"/>
        <FIELD NAME="ESPECIFICACOES" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="Especificacoes" NESTEDNAME="millenium_eco.PRODUTOS.ESPECIFICACAO" CTAB="0"/>
        <FIELD NAME="PESO" FORMAT="N" SIZE="15" FLAGS="1" DECIMALS="7" PROJECTION="0" ORDER="16" FIELDLABEL="Peso" CTAB="0"/>
        <FIELD NAME="TRANS_ID" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" FIELDLABEL="Trans Id" CTAB="0"/>
        <FIELD NAME="DATA_CADASTRO" FORMAT="H" SIZE="18" FLAGS="1" PROJECTION="0" FIELDLABEL="Data Cadastro" CTAB="0"/>
        <FIELD NAME="DATA_ATUALIZACAO" FORMAT="H" SIZE="18" FLAGS="1" PROJECTION="0" FIELDLABEL="Data Atualizacao" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT:PD
       #SELECT(TOP,
               NULL:{},
               ELSE:{#TOP(:TOP)})
               
          PRODUTO,DESCRICAO1,DESCRICAO2,DESCRICAO_TRADUZIDA,DESCRICAO_ORIGINAL,DESCRICAO_ETIQ,DESCRICAO_SF,DESCRICAO_LITERAL,GRADE,COD_PRODUTO,TIPO_PROD,WEB,
          COLECAO,DEPARTAMENTO,DIVISAO,GRUPO,MARCA,TIPO,OBS,PESO,PERMITE_PEDIDO_SEM_ESTOQUE,LEAD_TIME_ENTREGA,PRE_VENDA,DATA_LANCAMENTO,
          CL.COD_COLECAO,DP.COD_DEPARTAMENTO,DV.COD_DIVISAO,GR.COD_GRUPO,MR.COD_MARCA,TP.COD_TIPO,
          CL.DESCRICAO AS DESC_COLECAO,DP.DESCRICAO AS DESC_DEPARTAMENTO,DV.DESCRICAO AS DESC_DIVISAO,GR.DESCRICAO AS DESC_GRUPO,MR.DESCRICAO AS DESC_MARCA,
          TP.DESCRICAO AS DESC_TIPO,SUBCOLECAO,SC.COD_SUBCOLECAO,SC.DESCRICAO AS DESC_SUBCOLECAO,
          C.DESCRICAO AS DESC_CATEGORIA,C.COD_CATEGORIA,P.CATEGORIA,P.LARGURA,P.ALTURA,P.COMPRIMENTO,P.PESO,P.PERMITE_PEDIDO_SEM_ESTOQUE,P.LEAD_TIME_ENTREGA,P.PRE_VENDA,P.TRANS_ID,P.DATA_CADASTRO,P.DATA_ATUALIZACAO
          #ROWSET("SELECT:ESPECIFICACOES ES.DESCRICAO, EP.ESPECIFICACAO, EP.VALOR, EP.DESCRICAO AS DESC_PROD
                   FROM ESPEC_PRODUTOS EP
                   INNER JOIN ESPECIFICACOES ES ON EP.ESPECIFICACAO =ES.ESPECIFICACAO
                   WHERE EP.PRODUTO=:PD.PRODUTO"),
          #ROWSET("SELECT:CORES c.COR, c.COD_COR, c.DESCRICAO, c.INDICE FROM COR_PROD p INNER JOIN CORES c ON p.COR=c.COR WHERE p.PRODUTO=:PD.PRODUTO ORDER BY 2"),
          #ROWSET({SELECT:SKU SKU.PRODUTO||"_"||SKU.COR||"_"||SKU.ESTAMPA||"_"||SKU.TAMANHO  AS SKU,SKU.PRODUTO,SKU.COR,SKU.ESTAMPA,SKU.TAMANHO,
                              SUM(SKU.ESTOQUE) AS ESTOQUE,MAX(SKU.PRECO1) AS PRECO1,MAX(SKU.PRECO2) AS PRECO2, C.DESCRICAO AS DESC_COR, ES.DESCRICAO AS DESC_ESTAMPA,
                              #NULL_TO_N(#NULL_TO_N(CAST(MAX(CS.LARGURA) AS DOUBLE PRECISION),CAST(MAX(P.LARGURA) AS DOUBLE PRECISION)),#NULL_TO_Z(CAST(:PD.LARGURA AS DOUBLE PRECISION))) AS LARGURA,
                              #NULL_TO_N(#NULL_TO_N(CAST(MAX(CS.ALTURA) AS DOUBLE PRECISION),CAST(MAX(P.ALTURA) AS DOUBLE PRECISION)),#NULL_TO_Z(CAST(:PD.ALTURA AS DOUBLE PRECISION))) AS ALTURA,
                              #NULL_TO_N(#NULL_TO_N(CAST(MAX(CS.COMPRIMENTO) AS DOUBLE PRECISION),CAST(MAX(P.COMPRIMENTO) AS DOUBLE PRECISION)),#NULL_TO_Z(CAST(:PD.COMPRIMENTO AS DOUBLE PRECISION))) AS COMPRIMENTO,
                              #NULL_TO_N(#NULL_TO_N(CAST(MAX(CS.PESO) AS DOUBLE PRECISION),CAST(MAX(P.PESO) AS DOUBLE PRECISION)),#NULL_TO_Z(CAST(:PD.PESO AS DOUBLE PRECISION))) AS PESO,
                              #NULL_TO_S(#NULL_TO_S(MAX(CS.PERMITE_PEDIDO_SEM_ESTOQUE),MAX(P.PERMITE_PEDIDO_SEM_ESTOQUE)),:PD.PERMITE_PEDIDO_SEM_ESTOQUE) AS PERMITE_PEDIDO_SEM_ESTOQUE,
                              #NULL_TO_N(#NULL_TO_N(MAX(CS.LEAD_TIME_ENTREGA),MAX(P.LEAD_TIME_ENTREGA)),#NULL_TO_Z(:PD.LEAD_TIME_ENTREGA)) AS LEAD_TIME_ENTREGA,
                              #NULL_TO_S(#NULL_TO_S(MAX(CS.PRE_VENDA),MAX(P.PRE_VENDA)),:PD.PRE_VENDA) AS PRE_VENDA,
                              MAX(CS.DATA_LANCAMENTO) AS DATA_LANCAMENTO,MAX(CS.INICIO_PRE_VENDA) AS INICIO_PRE_VENDA,MAX(CS.PERMITE_ANTECIPAR_PICKING) AS PERMITE_ANTECIPAR_PICKING,
                              MAX(CS.REFERENCIA) AS REFERENCIA
                   FROM #VIEW(SELECT E.PRODUTO,E.COR,E.ESTAMPA,E.TAMANHO,(E.SALDO) AS ESTOQUE,0 AS PRECO1,0 AS PRECO2 FROM ESTOQUES E
                              WHERE E.FILIAL=:FILIAL AND E.PRODUTO=:PD.PRODUTO
                              UNION ALL
                              SELECT PR1.PRODUTO,PR1.COR,PR1.ESTAMPA,PR1.TAMANHO,0 AS ESTOQUE,(PR1.PRECO) AS PRECO1,0 AS PRECO2 FROM PRECOS PR1
                              WHERE PR1.TABELA=:TABELA1 AND PR1.PRODUTO=:PD.PRODUTO
                              UNION ALL
                              SELECT PR2.PRODUTO,PR2.COR,PR2.ESTAMPA,PR2.TAMANHO,0 AS ESTOQUE,0 AS PRECO1,(PR2.PRECO) AS PRECO2 FROM PRECOS PR2
                              WHERE PR2.TABELA=:TABELA2 AND PR2.PRODUTO=:PD.PRODUTO) SKU
                   INNER JOIN CORES C ON C.COR = SKU.COR
                   INNER JOIN ESTAMPAS ES ON ES.ESTAMPA = SKU.ESTAMPA
                   INNER JOIN PRODUTOS P ON P.PRODUTO = SKU.PRODUTO
                   LEFT JOIN CARACTERISTICA_SKU CS ON CS.PRODUTO = SKU.PRODUTO AND CS.COR = SKU.COR AND CS.ESTAMPA = SKU.ESTAMPA AND CS.TAMANHO = SKU.TAMANHO
                   GROUP BY SKU.PRODUTO,SKU.COR,SKU.ESTAMPA,SKU.TAMANHO,C.DESCRICAO,ES.DESCRICAO
                   HAVING EXISTS (SELECT 1 FROM COR_PROD WHERE PRODUTO=SKU.PRODUTO AND COR=SKU.COR) AND
                          EXISTS (SELECT 1 FROM TAM_PROD WHERE PRODUTO=SKU.PRODUTO AND TAMANHO=SKU.TAMANHO) AND
                          EXISTS (SELECT 1 FROM ESTAMPA_PROD WHERE PRODUTO=SKU.PRODUTO AND ESTAMPA=SKU.ESTAMPA)
                  }),
          #ROWSET("SELECT:ESTAMPAS * FROM ESTAMPA_PROD,ESTAMPAS WHERE ESTAMPA_PROD.ESTAMPA=ESTAMPAS.ESTAMPA AND ESTAMPA_PROD.PRODUTO=:PD.PRODUTO"),
          #ROWSET("SELECT:TAMANHOS TAMANHO,TAM_PROD as INDICE FROM TAM_PROD WHERE PRODUTO=:PD.PRODUTO ORDER BY TAM_PROD")

FROM PRODUTOS P
#SELECT(PEDIDOV,NULL:{},ELSE:{
  INNER JOIN #VIEW(SELECT DISTINCT PRODUTO FROM PRODUTO_PEDIDOV WHERE PEDIDOV=:PEDIDOV) pV ON pV.PRODUTO=P.PRODUTO
})
LEFT JOIN COLECOES CL ON P.COLECAO=CL.COLECAO
LEFT JOIN DEPARTAMENTOS DP ON P.DEPARTAMENTO=DP.DEPARTAMENTO
LEFT JOIN DIVISOES DV ON P.DIVISAO=DV.DIVISAO
LEFT JOIN GRUPOS GR ON P.GRUPO=GR.GRUPO
LEFT JOIN MARCAS MR ON P.MARCA=MR.MARCA
LEFT JOIN TIPOS TP ON P.TIPO=TP.TIPO
LEFT JOIN SUBCOLECOES SC ON P.SUBCOLECAO=SC.SUBCOLECAO
LEFT JOIN CATEGORIASP C ON P.CATEGORIA=C.CATEGORIA
WHERE TIPO_PROD='AC'
      [AND P.DIVISAO=:DIVISAO]
      [AND P.MARCA=:MARCA]
      [AND WEB=:WEB]
      [AND P.PRODUTO=:PRODUTO]
      [AND P.COD_PRODUTO=:COD_PRODUTO]
      [AND P.COLECAO IN #REPLACE(COLECOES)]
      AND GR.COD_GRUPO IN ('001','002','003','004','005','006','007','008','009','010','011','012')
      #SELECT(TRANS_ID,NULL:{[AND DATA_ATUALIZACAO>:DATA_ATUALIZACAO_INICIAL]},ELSE:{ [AND TRANS_ID >:TRANS_ID]})
ORDER BY PRODUTO; 
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>