<?xml version="1.0"?>
<root>
  <OBJECT NAME="B2B">
    <METHOD NAME="ListaCondicoesPgto" DESCRIPTION="Lista Condi&#231;&#245;es de Pgto" VERSION="71" INTFTYPE="5" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="CLIENTE" FORMAT="N" SIZE="8" FLAGS="2" PROJECTION="0" HINT="Campo correspondente ao cliente." FIELDLABEL="Cliente" CTAB="0"/>
        <PARAM NAME="TIPO_VENDA" SIZE="1" FLAGS="2" PROJECTION="0" HINT="Campo correspondente ao tipo de venda. &lt;b>(T = Todos, V = Varejo, A = Atacado, C = Cat&#225;logo).&lt;/b>" FIELDLABEL="Tipo Operacao" CTAB="0"/>
        <PARAM NAME="FILIAL" FORMAT="N" SIZE="8" FLAGS="2" PROJECTION="0" HINT="Campo correspondente a filial de pagamento." FIELDLABEL="Filial" CTAB="0"/>
        <PARAM NAME="TABELA" FORMAT="N" SIZE="8" FLAGS="2" PROJECTION="0" HINT="Campo correspondente a tabela de pre&#231;o." FIELDLABEL="Tabela" CTAB="0"/>
        <PARAM NAME="TIPO_OPERACAO" SIZE="1" FLAGS="2" PROJECTION="0" HINT="Campo correspondente ao tipo de opera&#231;&#227;o. &lt;b>(T = Todos, V = Varejo, A = Atacado, C = Cat&#225;logo). &lt;/b>" FIELDLABEL="Tipo Operacao" CTAB="0"/>
        <PARAM NAME="CODIGO" SIZE="3" PROJECTION="0" HINT="Campo correspondente ao c&#243;digo da condi&#231;&#227;o de pagamento." FIELDLABEL="Codigo" CTAB="0"/>
        <PARAM NAME="TIPO_PGTO" FORMAT="N" SIZE="8" PROJECTION="0" HINT="Campo correspondente ao tipo de pagamento." FIELDLABEL="Tipo Pgto" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="CONDICOES_PGTO" FORMAT="N" SIZE="8" FLAGS="9" PROJECTION="0" ORDER="1" FIELDLABEL="Condicoes Pgto" CTAB="0"/>
        <FIELD NAME="CODIGO" SIZE="3" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="C&#243;digo" CTAB="0"/>
        <FIELD NAME="DESCRICAO" SIZE="50" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Descri&#231;&#227;o" CTAB="0"/>
        <FIELD NAME="TAXA" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" FIELDLABEL="Taxa" CTAB="0"/>
        <FIELD NAME="TIPO_OPERACAO" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Tipo Operacao" CTAB="0"/>
        <FIELD NAME="DESCONTO" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" FIELDLABEL="Desconto" CTAB="0"/>
        <FIELD NAME="TIPO_PGTO" FORMAT="N" SIZE="8" FLAGS="3" PROJECTION="0" ORDER="5" FIELDLABEL="Tipo Pgto" CTAB="0"/>
        <FIELD NAME="N_PARCELAS" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="N Parcelas" CTAB="0"/>
        <FIELD NAME="VALOR_MINIMO" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" FIELDLABEL="Valor Minimo" CTAB="0"/>
        <FIELD NAME="NATUREZA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="Natureza" CTAB="0"/>
        <FIELD NAME="DESC_TIPO_PGTO" SIZE="20" FLAGS="1" PROJECTION="0" ORDER="2" FIELDLABEL="Desc Tipo Pgto" CTAB="0"/>
        <FIELD NAME="DESC_REDE" SIZE="20" PROJECTION="0" FIELDLABEL="Desc Rede" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>#CALL:CFG millenium.configuracoes.consulta();

#SELECT( ((TABELA='') or (cfg.VALIDA_CONDPAG&lt;>2)),TRUE:{#SET(CONDTAB,0)},ELSE:{
#PRIVATE() SELECT:COND_TAB COUNT(*) AS C FROM TAB_PRECOxCONDPAG WHERE TABELA_PRECO=:TABELA;
#SET(CONDTAB,COND_TAB.C)});

#SELECT(CLIENTE,NULL:{#SET(CONDCLI,0)},ELSE:{
#PRIVATE() SELECT:COND_CLI COUNT(*) AS C FROM CONDICOES_CLIENTE WHERE CLIENTE=:CLIENTE;
#SET(CONDCLI,COND_CLI.C)});

#SELECT(FILIAL,NULL:{#SET(CONDFIL,0)},ELSE:{
#PRIVATE() SELECT:COND_FIL COUNT(*) AS C FROM CONDICOES_FILIAL WHERE FILIAL=:FILIAL;
#SET(CONDFIL,COND_FIL.C)});

SELECT  CP.CONDICOES_PGTO, CP.CODIGO, CP.DESCRICAO, CP.TAXA, CP.TIPO_OPERACAO, CP.DESCONTO, CP.TIPO_PGTO, TP.NATUREZA, TP.DESCRICAO AS DESC_TIPO_PGTO,R.DESCRICAO AS DESC_REDE,
       (select count(*) from condicoes_pgto cp2 where cp2.principal=CP.condicoes_pgto)+1 as N_PARCELAS,
       VALOR_MINIMO
FROM CONDICOES_PGTO CP INNER JOIN TIPOS_PGTOS TP ON CP.TIPO_PGTO=TP.TIPO_PGTO
     LEFT JOIN REDES R ON TP.REDE=R.REDE
WHERE PRINCIPAL IS NULL [AND (TIPO_OPERACAO=:TIPO_VENDA OR TIPO_OPERACAO='T')]
      #SELECT( TIPO_OPERACAO, 'S': {AND ( TIPO="V" OR TIPO="T" )},
                              'E': {AND ( TIPO="C" OR TIPO="T" )},
                             ELSE: {} )
      #SELECT(((CONDCLI>0) AND NOT (CLIENTE=NULL)),TRUE:{AND CONDICOES_PGTO IN (SELECT CONDICOES_PGTO FROM CONDICOES_CLIENTE WHERE CLIENTE=:CLIENTE)},ELSE:{})
      #SELECT(((CONDFIL>0) AND NOT (FILIAL=NULL)),TRUE:{AND CONDICOES_PGTO IN (SELECT CONDICOES_PGTO FROM CONDICOES_FILIAL WHERE FILIAL=:FILIAL)},ELSE:{})
      #SELECT(((CONDTAB>0) AND NOT (TABELA=NULL)),TRUE:{AND CONDICOES_PGTO IN (SELECT CONDICOES_PGTO FROM TAB_PRECOxCONDPAG WHERE TABELA_PRECO=:TABELA)},ELSE:{})
      [AND CODIGO=:CODIGO]
      [AND TIPO_PGTO=:TIPO_PGTO]
      AND ENVIA_PDA = 'T'
ORDER BY CODIGO;
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>