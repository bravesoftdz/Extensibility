<?xml version="1.0"?>
<root>
  <OBJECT NAME="MOVIMENTO_FRANQUIAS">
    <METHOD NAME="ConfirmaEntrega" DESCRIPTION="" VERSION="8" THREADSAFE="0">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="COD_OPERACAO" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Cod Operacao" CTAB="0"/>
        <PARAM NAME="TIPO_OPERACAO" SIZE="1" PROJECTION="0" FIELDLABEL="Tipo Operacao" CTAB="0"/>
        <PARAM NAME="DATA_ENTREGA" FORMAT="D" SIZE="10" FLAGS="17" DEFAULT="TODAY" PROJECTION="0" ORDER="1" FIELDLABEL="Data Entrega" CTAB="0"/>
        <PARAM NAME="NOME_RECEBEDOR" SIZE="50" FLAGS="17" PROJECTION="0" ORDER="2" FIELDLABEL="Nome Recebedor" CTAB="0"/>
      </PARAMS>
      <FIELDS/>
      <ACTIONSCRIPT>//Atualizar recebimento
#SELECT((:TIPO_OPERACAO='E')
  ,TRUE:{UPDATE ENTRADAS
           SET ENTREGA_CONFIRMADA=TRUE
              ,DATA_ENTREGA_CONFIRMADA=:DATA_ENTREGA
              ,NOME_RECEBEDOR=:NOME_RECEBEDOR
           WHERE ENTRADA=:COD_OPERACAO
             AND TIPO_OPERACAO_E=:TIPO_OPERACAO}
  ,ELSE:{});
  
SELECT:MOVS E1.EVL_COD_OPERACAO_REF FROM ENTRADAS E1 WHERE E1.ENTRADA = :COD_OPERACAO;

//Localiza pedidos da NF
#EACH()
SELECT:PEDIDO DISTINCT(PV.PEDIDOV) FROM PEDIDO_VENDA PV
  INNER JOIN PRODUTO_PEDIDOV PPV ON PPV.PEDIDOV = PV.PEDIDOV
WHERE PV.EFETUADO = 'T'
  AND PPV.SAIDA = :MOVS.EVL_COD_OPERACAO_REF;

//Atualiza pedido com informacao de entrega
#CALL MILLENIUM.PEDIDO_VENDA.EV_ENTREGUE(:PEDIDO.PEDIDOV);
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>