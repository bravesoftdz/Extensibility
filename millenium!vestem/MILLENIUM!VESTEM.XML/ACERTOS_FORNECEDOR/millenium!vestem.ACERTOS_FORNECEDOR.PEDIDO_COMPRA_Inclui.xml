<?xml version="1.0"?>
<root>
  <OBJECT NAME="ACERTOS_FORNECEDOR">
    <METHOD NAME="PEDIDO_COMPRA_Inclui" DESCRIPTION="Incluir Pedido Para Fechamento Consigna&#231;&#227;o" VERSION="429" INTFTYPE="5" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
          <GROUP NAME="Status"/>
          <GROUP NAME="Inf"/>
          <GROUP NAME="Produtos"/>
        </GROUPS>
        <PARAM NAME="COD_PEDIDOC" SIZE="15" PROJECTION="0" ORDER="2" FIELDLABEL="Pedido" CTAB="0"/>
        <PARAM NAME="FORNECEDOR" FORMAT="N" SIZE="8" FLAGS="25" STYLE="5" PROJECTION="0" ORDER="3" LOOKUP="FORNECEDORES.Lista_FiltroPopUp" LOOKUPKEY="FORNECEDOR" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_FORNECEDOR" FIELDLABEL="Fornecedor" CTAB="0"/>
        <PARAM NAME="FUNCIONARIO" FORMAT="N" SIZE="8" FLAGS="8" PROJECTION="0" ORDER="12" LOOKUP="FUNCIONARIOS.Lista_Simples" LOOKUPKEY="FUNCIONARIO" LOOKUPDISPLAY="NOME" LOOKUPCODE="COD_FUNCIONARIO" FIELDLABEL="Funcion&#225;rio" CTAB="0"/>
        <PARAM NAME="N_PEDIDO_FORNEC" SIZE="15" PROJECTION="0" ORDER="6" FIELDLABEL="N&#186; do Pedido Forn." CTAB="0"/>
        <PARAM NAME="ORCAMENTO" FORMAT="B" SIZE="1" FLAGS="16" DEFAULT="0" PROJECTION="0" ORDER="13" FIELDLABEL="Or&#231;amento" GROUPNAME="Status" CTAB="0"/>
        <PARAM NAME="VALIDADE" FORMAT="D" SIZE="14" PROJECTION="0" ORDER="10" FIELDLABEL="Validade" CTAB="0"/>
        <PARAM NAME="FILIAL" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="4" FIELDLABEL="Filial" CTAB="0"/>
        <PARAM NAME="DATA_VENDA_INICIAL" FORMAT="D" SIZE="14" FLAGS="17" DEFAULT="Today" PROJECTION="0" ORDER="4" FIELDLABEL="Data Venda Inicial" CTAB="0"/>
        <PARAM NAME="DATA_VENDA_FINAL" FORMAT="D" SIZE="14" FLAGS="17" DEFAULT="Today" PROJECTION="0" ORDER="5" FIELDLABEL="Data Venda Final" CTAB="0"/>
        <PARAM NAME="DATA_LIMITE" FORMAT="D" SIZE="14" PROJECTION="0" ORDER="11" FIELDLABEL="Data Limite" CTAB="0"/>
        <PARAM NAME="CONDICOES_PGTO" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="11" FIELDLABEL="Condi&#231;&#245;es de Pagto" CTAB="0"/>
        <PARAM NAME="PRAZO_ENTREGA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="9" FIELDLABEL="Prazo de Entrega" CTAB="0"/>
        <PARAM NAME="TOTAL" FORMAT="M" SIZE="17" DECIMALS="4" PROJECTION="0" ORDER="13" FIELDLABEL="Total" GROUPNAME="Inf" CTAB="0"/>
        <PARAM NAME="ACERTO" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" ORDER="14" FIELDLABEL="Acerto (-/+ (%) )" GROUPNAME="Inf" CTAB="0"/>
        <PARAM NAME="V_ACERTO" FORMAT="M" SIZE="17" DECIMALS="4" PROJECTION="0" ORDER="15" FIELDLABEL="Valor Acerto" GROUPNAME="Inf" CTAB="0"/>
        <PARAM NAME="OBS" PROJECTION="0" ORDER="15" FIELDLABEL="Obs" GROUPNAME="Status" CTAB="0"/>
        <PARAM NAME="TIPO" SIZE="2" FLAGS="17" DEFAULT="AC" PROJECTION="0" ORDER="6" LOOKUP="list:'AC','Produto Acabado';'MP','Mat&#233;ria-Prima';'SE','Servi&#231;os';'MC','Material de Consumo';'TO','M&#250;ltiplos';" FIELDLABEL="Tipo de Produto" CTAB="0"/>
        <PARAM NAME="APROVADO" FORMAT="B" SIZE="1" FLAGS="16" DEFAULT="0" PROJECTION="0" ORDER="14" FIELDLABEL="Aprovado" GROUPNAME="Status" CTAB="0"/>
        <PARAM NAME="PRODUTOS" FORMAT="R" STYLE="3" PROJECTION="0" ORDER="10" FIELDLABEL="Produtos" NESTEDNAME="MILLENIUM.PEDIDO_COMPRA.PRODUTOS" GROUPNAME="Produtos" CTAB="0"/>
        <PARAM NAME="EFETUADO" FORMAT="B" SIZE="1" DEFAULT="0" PROJECTION="0" ORDER="19" FIELDLABEL="Efetuado" GROUPNAME="Status" CTAB="0"/>
        <PARAM NAME="QUANTIDADE" FORMAT="N" SIZE="15" DECIMALS="4" PROJECTION="0" ORDER="12" FIELDLABEL="Quantidade" GROUPNAME="Inf" CTAB="0"/>
        <PARAM NAME="CORTESIA" FORMAT="M" SIZE="17" DECIMALS="4" PROJECTION="0" FIELDLABEL="Cortesia" CTAB="0"/>
        <PARAM NAME="DESCONTOS" FORMAT="R" PROJECTION="0" FIELDLABEL="Descontos" NESTEDNAME="MILLENIUM.MOVIMENTACAO.DESCONTOS" CTAB="0"/>
        <PARAM NAME="TABELA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="5" FIELDLABEL="Tabela" CTAB="0"/>
        <PARAM NAME="TABCUSTO" FORMAT="B" SIZE="1" DEFAULT="1" PROJECTION="0" FIELDLABEL="Tab Custo" CTAB="0"/>
        <PARAM NAME="ATUALIZAR_TABELA" FORMAT="B" SIZE="1" DEFAULT="0" PROJECTION="0" FIELDLABEL="Atualizar Tabela" CTAB="0"/>
        <PARAM NAME="COLECAO" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="5" FIELDLABEL="Cole&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="ENDERECO_ENTREGA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="4" FIELDLABEL="Endere&#231;o de Entrega" CTAB="0"/>
        <PARAM NAME="ENDERECO_COBRANCA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="5" FIELDLABEL="Endere&#231;o de Cobran&#231;a" CTAB="0"/>
        <PARAM NAME="MOEDA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="13" LOOKUP="MOEDAS.Lista" LOOKUPKEY="MOEDA" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Moeda" CTAB="0"/>
        <PARAM NAME="FORN_INTERMEDIARIO" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Forn Intermediario" CTAB="0"/>
        <PARAM NAME="CONTA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="9" FIELDLABEL="Conta" CTAB="0"/>
        <PARAM NAME="CENTRO_CUSTOS" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="11" FIELDLABEL="Centro Custos" CTAB="0"/>
        <PARAM NAME="PCONTA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="10" FIELDLABEL="Plano de Contas" CTAB="0"/>
        <PARAM NAME="REPRESENTANTE" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Representante" CTAB="0"/>
        <PARAM NAME="TRANSPORTADORA" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Transportadora" CTAB="0"/>
        <PARAM NAME="CIF_FOB" SIZE="1" PROJECTION="0" FIELDLABEL="Cif Fob" CTAB="0"/>
        <PARAM NAME="VALOR_IPI" FORMAT="M" SIZE="17" DECIMALS="4" PROJECTION="0" FIELDLABEL="Valor Ipi" CTAB="0"/>
        <PARAM NAME="ESTADO_FILIAL" SIZE="2" PROJECTION="0" ORDER="3" FIELDLABEL="Estado" CTAB="0"/>
        <PARAM NAME="V_FRETE" FORMAT="M" SIZE="17" DECIMALS="4" PROJECTION="0" FIELDLABEL="V Frete" CTAB="0"/>
        <PARAM NAME="STATUS" FORMAT="N" SIZE="8" DEFAULT="0" PROJECTION="0" LOOKUP="list:'0','Apenas Cadastrado';'1','Em an&#225;lise';'2','Aprovado';'3','Reprovado';" FIELDLABEL="Status" CTAB="0"/>
        <PARAM NAME="TOLER_ENTREGA" FORMAT="N" SIZE="17" DECIMALS="4" DEFAULT="0" PROJECTION="0" ORDER="22" FIELDLABEL="Toler&#226;ncia Entrega (dias)" CTAB="0"/>
        <PARAM NAME="TOLER_QTDE" FORMAT="N" SIZE="17" DECIMALS="4" DEFAULT="0" PROJECTION="0" ORDER="23" FIELDLABEL="Toler&#226;ncia Qtde (%)" CTAB="0"/>
        <PARAM NAME="PEDIDOS" FORMAT="R" PROJECTION="0" ORDER="13" FIELDLABEL="Pedidos" NESTEDNAME="MILLENIUM.PEDIDO_COMPRA.PEDIDOV" CTAB="0"/>
        <PARAM NAME="LANCAMENTOS" FORMAT="R" PROJECTION="0" FIELDLABEL="Lancamentos" NESTEDNAME="MILLENIUM.EVENTOS.Lancamentos" CTAB="0"/>
        <PARAM NAME="PEDIDO_COLETOR" SIZE="500" PROJECTION="0" FIELDLABEL="Pedido Coletor" CTAB="0"/>
        <PARAM NAME="STATUS_ATUAL" FORMAT="N" SIZE="8" FLAGS="128" PROJECTION="0" ORDER="2" LOOKUP="list:'0','Apenas Cadastrado';'1','Em an&#225;lise';'2','Aprovado';'3','Reprovado';" FIELDLABEL="Status Atual" CTAB="0"/>
        <PARAM NAME="CONSIDERA_DESCONTO" FORMAT="B" SIZE="1" DEFAULT="0" PROJECTION="0" FIELDLABEL="Considera Desconto" CTAB="0"/>
        <PARAM NAME="FILIAL_ENTREGA" FORMAT="R" PROJECTION="0" FIELDLABEL="Filial Entrega" NESTEDNAME="MILLENIUM.PEDIDO_COMPRA.FILIAIS_ENTREGA" CTAB="0"/>
        <PARAM NAME="DISTRIBUIDO" FORMAT="B" SIZE="1" PROJECTION="0" FIELDLABEL="Distribuido" CTAB="0"/>
        <PARAM NAME="APLICA_DESC_FIXO" FORMAT="B" SIZE="1" PROJECTION="0" FIELDLABEL="Aplica Desc Fixo" CTAB="0"/>
        <PARAM NAME="VALOR_COTACAO" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" FIELDLABEL="Valor Cotacao" CTAB="0"/>
        <PARAM NAME="PEDIDOC_ORIGINAL" FORMAT="N" SIZE="8" PROJECTION="0" FIELDLABEL="Pedidoc Original" CTAB="0"/>
        <PARAM NAME="TOTAL_IMPOSTOS" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" FIELDLABEL="Total Impostos" CTAB="0"/>
        <PARAM NAME="TOTAL_IPI" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" FIELDLABEL="Total Ipi" CTAB="0"/>
        <PARAM NAME="DATA_SISTEMA" FORMAT="H" SIZE="18" FLAGS="129" DEFAULT="TODAY" PROJECTION="0" ORDER="1" FIELDLABEL="Data do Sistema" CTAB="0"/>
        <PARAM NAME="CC_PRODUTOS_EVENTOS" FORMAT="R" PROJECTION="0" FIELDLABEL="Cc Produtos Eventos" NESTEDNAME="MILLENIUM.MOVIMENTACAO.CC_PRODUTOS_EVENTOS" CTAB="0"/>
        <PARAM NAME="DATA_DIGITADO" FORMAT="D" SIZE="10" PROJECTION="0" FIELDLABEL="Data Digitado" CTAB="0"/>
        <PARAM NAME="COD_PREPEDIDOC" SIZE="15" PROJECTION="0" ORDER="3" FIELDLABEL="Pr&#233;-Pedido" CTAB="0"/>
        <PARAM NAME="MARCA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="14" LOOKUP="MARCAS.LISTAR" LOOKUPKEY="MARCA" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="COD_MARCA" FIELDLABEL="Marca" CTAB="0"/>
        <PARAM NAME="TIPO_PRODUCAO" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="26" FIELDLABEL="Tipo de Produ&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="MODALIDADE_FRETE" SIZE="1" PROJECTION="0" FIELDLABEL="Modalidade Frete" CTAB="0"/>
        <PARAM NAME="EMAIL_ENVIADO" FORMAT="B" SIZE="1" PROJECTION="0" FIELDLABEL="Email Enviado" CTAB="0"/>
        <PARAM NAME="EMAIL_CONFIRMADO" FORMAT="B" SIZE="1" PROJECTION="0" FIELDLABEL="Email Confirmado" CTAB="0"/>
        <PARAM NAME="TOTAL_SUB" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" FIELDLABEL="Total Sub" CTAB="0"/>
        <PARAM NAME="TIPO_PEDIDO" FORMAT="N" SIZE="8" FLAGS="1" DEFAULT="1" PROJECTION="0" ORDER="2" LOOKUP="TIPOS_PEDIDO.LISTA" LOOKUPKEY="TIPO_PEDIDO" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Tipo Pedido" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="PEDIDOC" FORMAT="+" SIZE="8" FLAGS="1032" PROJECTION="0" FIELDLABEL="Pedidoc" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>
select :PED 'PAC'||af.acerto_fornecedor as COD_PEDIDOC, af.fornecedor FORNECEDOR,3 as filial,
   af.data as DATA_EMISSAO,af.data as DATA_ENTREGA,
    Af.valor AS TOTAL,
    'Acerto de consigna&#231;&#227;o periodo de vendas de '||af.data_venda_inicial ||' a '|| af.data_venda_final as OBS,
    'AC' as tipo,sum(afi.quantidade) as QUANTIDADE
from acertos_fornecedor af
    inner join fornecedores f on f.fornecedor=af.fornecedor
    inner join acertos_fornecedor_itens afi on afi.acerto_fornecedor=af.acerto_fornecedor
   where  af.FORNECEDOR=:FORNECEDOR
     [and af.data_venda_inicial]
     [and af.data_venda_final]
group by 1,2,3,4,5,6,7  ;

INSERT :IPED INTO PEDIDO_COMPRA(COD_PEDIDOC, FORNECEDOR, FILIAL, DATA_EMISSAO, DATA_ENTREGA,
                               CONDICOES_PGTO, TOTAL, ACERTO,
                               V_ACERTO, OBS, TIPO, APROVADO, QUANTIDADE, CORTESIA,
                               TABELA, CONTA, PCONTA,
                               DATA_DIGITADO,
                               DATA_SISTEMA,
                               EFETUADO,
                               TIPO_PEDIDO)
                      VALUES ( :ped.COD_PEDIDOC, :ped.FORNECEDOR,
                               :ped.FILIAL, :ped.DATA_EMISSAO, :ped.DATA_ENTREGA, :CONDICOES_PGTO,
                               :ped.TOTAL, :ACERTO, :V_ACERTO, :ped.OBS, :ped.TIPO, :APROVADO,
                               :ped.QUANTIDADE, :CORTESIA, :TABELA,
                               :CONTA, :PCONTA,
                               #DATE(),
                               :DATA_SISTEMA,
                               :EFETUADO,
                               :TIPO_PEDIDO )
#RETURN ( PEDIDOC);


#EACH() select :PRODS PRODUTOS.PRODUTO,COR,ESTAMPA,TAMANHO,UNIDADE_COMPRA AS UNIDADE_CONVERSAO,
       'T' AS APLICA_FATOR_CONVERSAO,
       FATOR_CA AS FATOR_CONVERSAO,sum(QUANTIDADE)as QUANTIDADE,avg(PRECO)as PRECO
    from acertos_fornecedor_itens
         INNER JOIN PRODUTOS ON PRODUTOS.PRODUTO=acertos_fornecedor_itens.PRODUTO AND PRODUTOS.TIPO_PROD='AC'
group by 1,2,3,4,5,6,7;


INSERT INTO PRODUTO_PEDIDOC( PEDIDOC, PRODUTO, COR, ESTAMPA, TAMANHO, QUANTIDADE, PRECO, ENTREGUE, TRANSITO, PREFATURADO,PREFATURADO_E,DESVIO,DESVIO_PF,
                             UNIDADE_CONVERSAO, FATOR_CONVERSAO, APLICA_FATOR_CONVERSAO )

VALUES ( :IPED.PEDIDOC, :PRODS.PRODUTO, :PRODS.COR, :PRODS.ESTAMPA, :PRODS.TAMANHO, :PRODS.QUANTIDADE, :PRODS.PRECO, 0, 0, 0,0,0,0,
         :PRODS.UNIDADE_CONVERSAO, :PRODS.FATOR_CONVERSAO, :PRODS.APLICA_FATOR_CONVERSAO )
#RETURN ( PRODUTO_PC);

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>