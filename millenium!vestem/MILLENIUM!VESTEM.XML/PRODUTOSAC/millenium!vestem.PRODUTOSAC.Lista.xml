<?xml version="1.0"?>
<root>
  <OBJECT NAME="PRODUTOSAC">
    <METHOD NAME="Lista" DESCRIPTION="Listar Produtos com Filtro " VERSION="214" INTFTYPE="14" TRIGGEROF="PRODUTOSAC.LISTA" TRIGGERTYPE="0" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP NAME="Demais Op&#231;&#245;es de Filtro"/>
        </GROUPS>
        <PARAM NAME="PERFIL_IMPOSTO" SIZE="1000" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="2" LOOKUP="MILLENIUM.PERFIL_IMPOSTOS.Lista" LOOKUPKEY="PERFIL_IMPOSTO" LOOKUPDISPLAY="DESCRICAO" FIELDLABEL="Perfil Imposto" GROUPNAME="Demais Op&#231;&#245;es de Filtro" CTAB="0"/>
        <PARAM NAME="CLASSIFICACAO_FIS" SIZE="1000" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="1" LOOKUP="MILLENIUM.CLASSIFICACAO_FIS.Lista" LOOKUPKEY="CLASSIFICACAO_FIS" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Classifica&#231;&#227;o Fiscal" GROUPNAME="Demais Op&#231;&#245;es de Filtro" CTAB="0"/>
        <PARAM NAME="VITRINE_SITE" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Vitrine Site" GROUPNAME="Demais Op&#231;&#245;es de Filtro" CTAB="0"/>
        <PARAM NAME="VITRINE_HUB" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="Vitrine Hub" GROUPNAME="Demais Op&#231;&#245;es de Filtro" CTAB="0"/>
        <PARAM NAME="VITRINE_CD" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Vitrine CD Matriz" GROUPNAME="Demais Op&#231;&#245;es de Filtro" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="DESC_PERFIL_IMPOSTO" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Perfil Imposto" CTAB="0"/>
        <FIELD NAME="DESC_CLASSIFICACAO_FIS" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Classifica&#231;&#227;o Fiscal" CTAB="0"/>
        <FIELD NAME="VITRINE_SITE" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Vitrine Site" CTAB="0"/>
        <FIELD NAME="VITRINE_HUB" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Vitrine Hub" CTAB="0"/>
        <FIELD NAME="ESTOQUE_MATRIZ" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Estoque Matriz" CTAB="0"/>
        <FIELD NAME="ESTOQUE_LOJA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="Estoque Loja" CTAB="0"/>
        <FIELD NAME="VITRINE_MATRIZ" FORMAT="B" SIZE="1" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Vitrine CD Matriz" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>
SELECT
  C.*,
  PI.DESCRICAO                              AS DESC_PERFIL_IMPOSTO,
  CF.CODIGO||' - '||CF.DESCRICAO            AS DESC_CLASSIFICACAO_FIS,
  #IF((SELECT COUNT(*) FROM VITRINE_PRODUTOS VP1 WHERE VP1.VITRINE = 26 AND VP1.PRODUTO = P.PRODUTO)>0,"T","F") as VITRINE_SITE,
  #IF((SELECT COUNT(*) FROM VITRINE_PRODUTOS VP2 WHERE VP2.VITRINE = 32 AND VP2.PRODUTO = P.PRODUTO)>0,"T","F") as VITRINE_HUB,
  #IF((SELECT COUNT(*) FROM VITRINE_PRODUTOS VP3 WHERE VP3.VITRINE = 34 AND VP3.PRODUTO = P.PRODUTO)>0,"T","F") as VITRINE_MATRIZ,
  (SELECT SUM(#NULL_TO_Z(E.SALDO)) FROM ESTOQUES E WHERE E.FILIAL = 2 AND E.PRODUTO = P.PRODUTO) AS ESTOQUE_MATRIZ,
  (SELECT SUM(#NULL_TO_Z(E.SALDO)) FROM ESTOQUES E WHERE E.FILIAL = 33 AND E.PRODUTO = P.PRODUTO) AS ESTOQUE_LOJA
FROM #REPLACE(PARENT_RESULT) C
  INNER JOIN PRODUTOS          P  ON (P.PRODUTO=C.PRODUTO)
  INNER JOIN PERFIL_IMPOSTOS   PI ON (PI.PERFIL_IMPOSTO=P.PERFIL_IMPOSTO)
  INNER JOIN CLASSIFICACAO_FIS CF ON (CF.CLASSIFICACAO_FIS=P.CLASSIFICACAO_FIS)
WHERE [P.PERFIL_IMPOSTO    IN #REPLACE(PERFIL_IMPOSTO)]
  [AND P.CLASSIFICACAO_FIS IN #REPLACE(CLASSIFICACAO_FIS)]

#SELECT(VITRINE_SITE,
  TRUE:{[AND EXISTS (SELECT * FROM VITRINE_PRODUTOS VP3 WHERE VP3.VITRINE = 26 AND VP3.PRODUTO = P.PRODUTO)]},
  FALSE:{[AND NOT EXISTS (SELECT * FROM VITRINE_PRODUTOS VP3 WHERE VP3.VITRINE = 26 AND VP3.PRODUTO = P.PRODUTO)]},
  ELSE:{}
)
#SELECT(VITRINE_HUB,
  TRUE:{[AND EXISTS (SELECT * FROM VITRINE_PRODUTOS VP4 WHERE VP4.VITRINE = 32 AND VP4.PRODUTO = P.PRODUTO)]},
  FALSE:{[AND NOT EXISTS (SELECT * FROM VITRINE_PRODUTOS VP4 WHERE VP4.VITRINE = 32 AND VP4.PRODUTO = P.PRODUTO)]},
  ELSE:{}
)
#SELECT(VITRINE_CD,
  TRUE:{[AND EXISTS (SELECT * FROM VITRINE_PRODUTOS VP4 WHERE VP4.VITRINE = 34 AND VP4.PRODUTO = P.PRODUTO)]},
  FALSE:{[AND NOT EXISTS (SELECT * FROM VITRINE_PRODUTOS VP4 WHERE VP4.VITRINE = 34 AND VP4.PRODUTO = P.PRODUTO)]},
  ELSE:{}
)




</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>