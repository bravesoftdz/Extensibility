<?xml version="1.0"?>
<root>
  <OBJECT NAME="PRODUTOSAC">
    <METHOD NAME="ListaEstoqueVitrinesku" DESCRIPTION="Consulta SKU Vitrine (EVL)" VERSION="270" INTFTYPE="5" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="PRODUTO" FORMAT="N" SIZE="8" FLAGS="1" STYLE="5" PROJECTION="0" ORDER="6" LOOKUP="MILLENIUM.PRODUTOS.Lista_Popup3" LOOKUPKEY="PRODUTOAC" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Produto" CTAB="0"/>
        <PARAM NAME="COR" FORMAT="N" SIZE="8" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="7" LOOKUP="MILLENIUM.PRODUTOS.ListaCores" LOOKUPKEY="COR" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="COD_COR" FIELDLABEL="Cor" CTAB="0"/>
        <PARAM NAME="ESTAMPA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="4" FIELDLABEL="Estampa" CTAB="0"/>
        <PARAM NAME="TAMANHO" SIZE="5" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="8" LOOKUP="MILLENIUM.PRODUTOS.ListaTAMANHOS" LOOKUPKEY="TAMANHO" LOOKUPDISPLAY="TAMANHO" FIELDLABEL="Tamanho" CTAB="0"/>
        <PARAM NAME="FILIAL" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="1" LOOKUP="millenium.filiais.lista" LOOKUPKEY="filial" LOOKUPDISPLAY="fantasia" LOOKUPCODE="cod_filial" FIELDLABEL="Filial" CTAB="0"/>
        <PARAM NAME="FILIAIS" SIZE="1000" PROJECTION="0" ORDER="11" FIELDLABEL="Filiais" CTAB="0"/>
        <PARAM NAME="DATA_ATUALIZACAO_INICIAL" FORMAT="H" SIZE="18" PROJECTION="0" ORDER="9" FIELDLABEL="Data Atualizacao" CTAB="0"/>
        <PARAM NAME="WEB" SIZE="1" PROJECTION="0" ORDER="12" FIELDLABEL="Web" CTAB="0"/>
        <PARAM NAME="DIVISAO" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="10" FIELDLABEL="Divisao" CTAB="0"/>
        <PARAM NAME="MARCA" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="7" FIELDLABEL="Marca" CTAB="0"/>
        <PARAM NAME="VITRINE" FORMAT="N" SIZE="8" FLAGS="1" DEFAULT="26" PROJECTION="0" ORDER="2" LOOKUP="millenium_vitrine.vitrine.LISTA" LOOKUPKEY="VITRINE" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Vitrine" CTAB="0"/>
        <PARAM NAME="COMPRAS" FORMAT="B" SIZE="1" PROJECTION="0" ORDER="6" FIELDLABEL="Compras" CTAB="0"/>
        <PARAM NAME="COLECOES" SIZE="1000" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="4" LOOKUP="MILLENIUM.COLECOES.LISTA" LOOKUPKEY="COLECAO" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Cole&#231;&#227;o" CTAB="0"/>
        <PARAM NAME="ESTOQUE_NIVEL_KIT" FORMAT="B" SIZE="1" PROJECTION="0" ORDER="4" FIELDLABEL="Estoque Nivel Kit" CTAB="0"/>
        <PARAM NAME="AGRUPAR_FILIAIS" FORMAT="B" SIZE="1" PROJECTION="0" ORDER="3" FIELDLABEL="Agrupar Filiais" CTAB="0"/>
        <PARAM NAME="TRANS_ID" FORMAT="N" SIZE="8" PROJECTION="0" ORDER="2" FIELDLABEL="Trans Id" CTAB="0"/>
        <PARAM NAME="SKUS" FORMAT="R" PROJECTION="0" ORDER="1" FIELDLABEL="Skus" NESTEDNAME="WTSSYSTEM.INTERNALTYPES.STRINGARRAY" CTAB="0"/>
        <PARAM NAME="ESTOQUE_DISPONIVEL" FORMAT="B" SIZE="1" FLAGS="1" DEFAULT="1" PROJECTION="0" HINT="Se acionado, exibe produtos com disponibilidade em estoque para venda na loja virtual. Considerando o estoque minimo determinado na vitrine" ORDER="9" FIELDLABEL="Estoque Disponivel" CTAB="0"/>
        <PARAM NAME="TIPOS" SIZE="1000" FLAGS="1" STYLE="6" PROJECTION="0" ORDER="5" LOOKUP="MILLENIUM.TIPOS.LISTA" LOOKUPKEY="TIPO" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="CODIGO" FIELDLABEL="Tipos" CTAB="0"/>
        <PARAM NAME="TABELA" FORMAT="N" SIZE="8" FLAGS="1" DEFAULT="17" PROJECTION="0" ORDER="3" LOOKUP="MILLENIUM.TABELAS_PRECO.Lista" LOOKUPKEY="TABELA" LOOKUPDISPLAY="DESCRICAO" LOOKUPCODE="COD_TPRECO" FIELDLABEL="Tabela" CTAB="0"/>
        <PARAM NAME="AGRUPA_PRODUTO" SIZE="1" FLAGS="1" DEFAULT="1" PROJECTION="0" HINT="Op&#231;&#227;o para agrupamento de produtos no resultado da consulta" ORDER="1" LOOKUP="list:'1','Produto';'2','Produto + Cor';'3','Produto + Cor + Tamanho';" FIELDLABEL="Tipo de Agrupamento" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="DESC_SKU" SIZE="255" FLAGS="1" PROJECTION="0" HINT="SKU no formato produto_cor_estampa_tamanho" ORDER="11" FIELDLABEL="Produto" CTAB="0"/>
        <FIELD NAME="SALDO" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="!Saldo de estoque do produto." ORDER="14" FIELDLABEL="Saldo" CTAB="0"/>
        <FIELD NAME="EMPENHO" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="!Saldo da reserva do produto (n&#227;o deve ser considerado como saldo dispon&#237;vel)" ORDER="28" FIELDLABEL="Empenho" CTAB="0"/>
        <FIELD NAME="PRODUTO" FORMAT="N" SIZE="8" PROJECTION="0" HINT="!Id do produto" ORDER="8" FIELDLABEL="Produto" CTAB="0"/>
        <FIELD NAME="COR" FORMAT="N" SIZE="8" PROJECTION="0" HINT="!Id da cor" ORDER="11" FIELDLABEL="Cor" CTAB="0"/>
        <FIELD NAME="ESTAMPA" FORMAT="N" SIZE="8" PROJECTION="0" HINT="!Id da estampa" ORDER="21" FIELDLABEL="Estampa" CTAB="0"/>
        <FIELD NAME="TAMANHO" SIZE="5" FLAGS="1" PROJECTION="0" HINT="!C&#243;digo do tamanho" ORDER="15" FIELDLABEL="Tamanho" CTAB="0"/>
        <FIELD NAME="DATA_ATUALIZACAO" FORMAT="H" SIZE="18" PROJECTION="0" HINT="!Data de atualiza&#231;&#227;o do pre&#231;o. Como os resultados s&#227;o ordenados por este campo, basta guardar o &#250;ltimo processado para informar como par&#226;metro DATA_ATUALIZACAO_INICIAL na pr&#243;xima chamada. Esse campo ser&#225; desconsiderado caso utilize trans_id, &#233; aconselhav&#233;l utilizar o trans_id" ORDER="21" FIELDLABEL="Data Atualizacao" CTAB="0"/>
        <FIELD NAME="VITRINE_PRODUTO_SKU" SIZE="20" PROJECTION="0" HINT="!Id do SKU" ORDER="31" FIELDLABEL="Vitrine Produto Sku" CTAB="0"/>
        <FIELD NAME="RESERVA_VITRINE" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="!Saldo da reserva dos pedidos vinculados a vitrine " ORDER="19" FIELDLABEL="Reserva Vitrine" CTAB="0"/>
        <FIELD NAME="RESERVA_NAOVITRINE" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="!Saldo da reserva dos pedidos n&#227;o vinculados a vitrine " ORDER="21" FIELDLABEL="Reserva Naovitrine" CTAB="0"/>
        <FIELD NAME="SALDO_VITRINE" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="!Saldo dos pedidos n&#227;o reservados vinculados a vitrine " ORDER="18" FIELDLABEL="Saldo Vitrine" CTAB="0"/>
        <FIELD NAME="SALDO_NAOVITRINE" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="!Saldo dos pedidos n&#227;o reservados e n&#227;o vinculados a vitrine " ORDER="20" FIELDLABEL="Saldo Naovitrine" CTAB="0"/>
        <FIELD NAME="DATA_COMPRA" FORMAT="D" SIZE="10" PROJECTION="0" HINT="!Data da compra do sku" ORDER="22" FIELDLABEL="Data Compra" CTAB="0"/>
        <FIELD NAME="SALDO_COMPRA" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="Saldo da compra do sku" ORDER="27" FIELDLABEL="Saldo Compra" CTAB="0"/>
        <FIELD NAME="ESTOQUE_MIN" FORMAT="N" SIZE="8" PROJECTION="0" HINT="!Estoque m&#237;nimo do sku" ORDER="15" FIELDLABEL="Minimo" CTAB="0"/>
        <FIELD NAME="BARRA" SIZE="40" FLAGS="1" PROJECTION="0" HINT="C&#243;digo de barras do sku" ORDER="16" FIELDLABEL="Barra" CTAB="0"/>
        <FIELD NAME="DATA_ENVIO" FORMAT="H" SIZE="18" PROJECTION="0" HINT="!Data de envio do sku" ORDER="15" FIELDLABEL="Data Envio" CTAB="0"/>
        <FIELD NAME="ID_EXTERNO" SIZE="255" PROJECTION="0" HINT="!Id Externo do sku" ORDER="18" FIELDLABEL="Id Externo" CTAB="0"/>
        <FIELD NAME="ID" SIZE="255" PROJECTION="0" HINT="!Id do sku(Ser&#225; o Id_externo se possuir valor, sen&#227;o ser&#225; o vitrine_produto_sku)" ORDER="14" FIELDLABEL="Id" CTAB="0"/>
        <FIELD NAME="FILIAL" FORMAT="N" SIZE="8" PROJECTION="0" HINT="!Filial do sku" ORDER="14" FIELDLABEL="Filial" CTAB="0"/>
        <FIELD NAME="FILIAL_EXTERNA" SIZE="50" FLAGS="2" PROJECTION="0" HINT="!Filial externa do sku" ORDER="12" FIELDLABEL="Filial Externa" CTAB="0"/>
        <FIELD NAME="KIT" FORMAT="B" SIZE="1" PROJECTION="0" HINT="!Indica se o sku &#233; um kit" ORDER="13" FIELDLABEL="Kit" CTAB="0"/>
        <FIELD NAME="COMPONENTE_KIT" FORMAT="B" SIZE="1" PROJECTION="0" HINT="!Indica se o sku &#233; um componente de kit" ORDER="13" FIELDLABEL="Componente Kit" CTAB="0"/>
        <FIELD NAME="DESC_PRODUTO" SIZE="255" FLAGS="1" PROJECTION="0" HINT="!Descri&#231;&#227;o do produto" ORDER="13" FIELDLABEL="Descri&#231;&#227;o" CTAB="0"/>
        <FIELD NAME="TRANS_ID" FORMAT="N" SIZE="8" PROJECTION="0" HINT="Trans_id" ORDER="11" FIELDLABEL="Trans Id" CTAB="0"/>
        <FIELD NAME="PERMITE_PEDIDO_SEM_ESTOQUE" SIZE="1" PROJECTION="0" HINT="!Permite a venda sem estoque" ORDER="8" FIELDLABEL="Permite Pedido Sem Estoque" CTAB="0"/>
        <FIELD NAME="SALDO_VITRINE_COM_RESERVA" FORMAT="N" SIZE="15" DECIMALS="7" PROJECTION="0" HINT="Se a plataforma possui o conceito de reserva, deve ser utilizado esse valor como saldo" ORDER="10" FIELDLABEL="Saldo Vitrine Com Reserva" CTAB="0"/>
        <FIELD NAME="SALDO_VITRINE_SEM_RESERVA" FORMAT="N" SIZE="15" FLAGS="1" DECIMALS="7" PROJECTION="0" HINT="Se a plataforma n&#227;o possui o conceito de reserva, deve ser utilizado esse valor como saldo" ORDER="22" FIELDLABEL="Saldo Vitrine" CTAB="0"/>
        <FIELD NAME="VITRINE" FORMAT="N" SIZE="8" PROJECTION="0" HINT="Id da vitrine" ORDER="8" FIELDLABEL="Vitrine" CTAB="0"/>
        <FIELD NAME="COD_PRODUTO" SIZE="60" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Codigo" CTAB="0"/>
        <FIELD NAME="FOTO" FORMAT="I" PROJECTION="0" ORDER="18" FIELDLABEL="Foto" CTAB="0"/>
        <FIELD NAME="DESC_COR" SIZE="30" FLAGS="1" PROJECTION="0" ORDER="14" FIELDLABEL="Cor" CTAB="0"/>
        <FIELD NAME="DESC_COLECAO" SIZE="40" FLAGS="1" PROJECTION="0" ORDER="17" FIELDLABEL="Cole&#231;&#227;o" CTAB="0"/>
        <FIELD NAME="DESC_TIPO" SIZE="40" FLAGS="1" PROJECTION="0" ORDER="18" FIELDLABEL="Tipo" CTAB="0"/>
        <FIELD NAME="PRECO_ATUAL" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="21" FIELDLABEL="Pre&#231;o Atual" CTAB="0"/>
        <FIELD NAME="PRECO_ANTERIOR" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="20" FIELDLABEL="Pre&#231;o Anterior" CTAB="0"/>
        <FIELD NAME="PRECO_INICIAL" FORMAT="M" SIZE="17" FLAGS="1" DECIMALS="4" PROJECTION="0" ORDER="19" FIELDLABEL="Pre&#231;o Inicial" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>//#CALL MILLENIUM.COTAS.ATUALIZACOTASDIARIAS();

#CALL:LIST_SKUS MILLENIUM_ECO.PRODUTOS.DECODIFICARSKUS(VITRINE=:VITRINE,SKUS=:SKUS);

SELECT //MAX(CAST(#MONTH(R.DATA_ATUALIZACAO)
       //           ||"/"||#DAY(R.DATA_ATUALIZACAO)
       //           ||"/"||#YEAR(R.DATA_ATUALIZACAO)
       //           ||" "||#HOUR(R.DATA_ATUALIZACAO)
       //           ||":"||#MINUTE(R.DATA_ATUALIZACAO)
       //           ||":"||CAST(#MIN_NUM(#CEIL(#SECOND(R.DATA_ATUALIZACAO)),59) AS INT)
       //     AS DATE)
       //) AS DATA_ATUALIZACAO,
       //MAX(R.DATA_COMPRA) AS DATA_COMPRA,
       #SELECT(AGRUPA_PRODUTO,
         '1':{R.PRODUTO,},
         '2':{R.PRODUTO,R.COR, MIN(CR.COD_COR) AS DESC_COR,},
         '3':{R.PRODUTO,R.COR,R.TAMANHO, MIN(CR.COD_COR) AS DESC_COR, MIN(R.BARRA) AS BARRA,},
         ELSE:{}
       )
       #SELECT(AGRUPA_PRODUTO,
         '1':{MIN(R.COD_PRODUTO)||" - "||MIN(R.DESC_PRODUTO)  AS DESC_SKU,},
         '2':{MIN(R.COD_PRODUTO)||" - "||MIN(R.DESC_PRODUTO)||" - "||MIN(CR.COD_COR)  AS DESC_SKU,},
         '3':{MIN(R.COD_PRODUTO)||" - "||MIN(R.DESC_PRODUTO)||" - "||MIN(CR.COD_COR)||" - "||MIN(R.TAMANHO)||" - "||MIN(R.BARRA) AS DESC_SKU,},
         ELSE:{}
       )
       MIN(R.COD_PRODUTO) AS COD_PRODUTO,
       MIN(R.DESC_PRODUTO) AS DESC_PRODUTO,
       MIN(CL.COD_COLECAO||" - "||CL.DESCRICAO) AS DESC_COLECAO,
       MIN(TP.COD_TIPO||" - "||TP.DESCRICAO) AS DESC_TIPO,
       MIN((SELECT FIRST 1 FOTO FROM FOTOS F WHERE F.PRODUTO = PD.PRODUTO AND F.FOTO IS NOT NULL ORDER BY F.ORDEM)) AS FOTO,
       AVG(
         (SELECT
           FIRST 1 IP1.PRECONEW
         FROM ALTPRECOS IP1
         WHERE IP1.TABELA  = :TABELA
           AND IP1.PRODUTO = R.PRODUTO
           AND IP1.COR     = R.COR
           AND IP1.TAMANHO = R.TAMANHO
           AND IP1.PRECONEW IS NOT NULL
       )) AS PRECO_INICIAL,
       AVG(
         (SELECT
           AVG(IP2.PRECO)
         FROM PRECOS IP2
         WHERE IP2.TABELA  = :TABELA
           AND IP2.PRODUTO = R.PRODUTO
           AND IP2.COR     = R.COR
           AND IP2.TAMANHO = R.TAMANHO
           AND IP2.PRECO &lt;> 0
       )) AS PRECO_ATUAL,
       AVG(
         (SELECT
           AVG(IP3.PRECO_OLD)
         FROM PRECOS IP3
         WHERE IP3.TABELA  = :TABELA
           AND IP3.PRODUTO = R.PRODUTO
           AND IP3.COR     = R.COR
           AND IP3.TAMANHO = R.TAMANHO
           AND IP3.PRECO &lt;> 0
       )) AS PRECO_ANTERIOR,
        #if(SUM(R.SALDO_VITRINE_SEM_RESERVA)>0,SUM(R.SALDO_VITRINE_SEM_RESERVA), 0)AS SALDO_VITRINE_SEM_RESERVA,
       //SUM(R.SALDO)                     AS SALDO,
       //SUM(R.EMPENHO)                   AS EMPENHO,
       //SUM(R.RESERVA_NAOVITRINE)        AS RESERVA_NAOVITRINE,
       //SUM(R.RESERVA_VITRINE)           AS RESERVA_VITRINE,
       //SUM(R.SALDO_NAOVITRINE)          AS SALDO_NAOVITRINE,
       //SUM(R.SALDO_VITRINE)             AS SALDO_VITRINE,
       //SUM(R.SALDO_VITRINE_COM_RESERVA) AS SALDO_VITRINE_COM_RESERVA,

       //SUM(R.SALDO_VITRINE_SEM_RESERVA) AS SALDO_VITRINE_SEM_RESERVA,
       //MAX(R.ESTOQUE_MIN)               AS ESTOQUE_MIN,
       //SUM(R.SALDO_COMPRA)              AS SALDO_COMPRA,

       //MIN(R.FILIAL) as FILIAL,
       //#SELECT(VITRINE ,NULL:{}
       //                ,ELSE:{R.VITRINE_PRODUTO_SKU,
       //                       R.DATA_ENVIO,
       //                       MAX(R.ID_EXTERNO) AS ID_EXTERNO,
       //                       MAX(R.ID) AS ID
       //                       #SELECT(AGRUPAR_FILIAIS,true:{}
       //                                              ,else:{, R.FILIAL_EXTERNA})
       //                                              ,R.COMPONENTE_KIT,
       //                       }
       //       )
       //R.KIT,
       //MAX(R.TRANS_ID) AS TRANS_ID,
       //R.PERMITE_PEDIDO_SEM_ESTOQUE,
       #REPLACET(:VITRINE) AS VITRINE
FROM (SELECT MAX(DATA_ATUALIZACAO) AS DATA_ATUALIZACAO,
             CAST(NULL AS TIMESTAMP) AS DATA_COMPRA,
             P.PRODUTO,
             E.COR,
             E.ESTAMPA,
             E.TAMANHO,
             P.COD_PRODUTO,
             SUM(E.SALDO) AS SALDO,
             SUM(E.EMPENHO) AS EMPENHO,
             #SELECT(VITRINE ,NULL:{0},ELSE:{#IF(SUM(E.RESERVA_NAOVITRINE)&lt;0,0,SUM(E.RESERVA_NAOVITRINE))}) AS RESERVA_NAOVITRINE,
             #SELECT(VITRINE ,NULL:{0},ELSE:{SUM(E.RESERVA_VITRINE)}) AS RESERVA_VITRINE,
             #SELECT(VITRINE ,NULL:{0},ELSE:{#IF(SUM(E.SALDO_NAOVITRINE)&lt;0,0,SUM(E.SALDO_NAOVITRINE))}) AS SALDO_NAOVITRINE,
             #SELECT(VITRINE ,NULL:{0},ELSE:{SUM(E.SALDO_VITRINE)}) AS SALDO_VITRINE,
             #SELECT(VITRINE ,NULL:{0},ELSE:{(((SUM(E.SALDO) + SUM(E.RESERVA_VITRINE))-(#IF(SUM(E.SALDO_NAOVITRINE)&lt;0,0,SUM(E.SALDO_NAOVITRINE)) - #IF(SUM(E.RESERVA_NAOVITRINE)&lt;0,0,SUM(E.RESERVA_NAOVITRINE)))) - MAX(E.ESTOQUE_MIN))}) AS SALDO_VITRINE_COM_RESERVA,
             #SELECT(VITRINE ,NULL:{0},ELSE:{((SUM(E.SALDO))-(SUM(E.SALDO_VITRINE) - SUM(E.RESERVA_VITRINE))-(#IF(SUM(E.SALDO_NAOVITRINE)&lt;0,0,SUM(E.SALDO_NAOVITRINE)) - #IF(SUM(E.RESERVA_NAOVITRINE)&lt;0,0,SUM(E.RESERVA_NAOVITRINE))) - MAX(E.ESTOQUE_MIN))}) AS SALDO_VITRINE_SEM_RESERVA,
             #SELECT(VITRINE ,NULL:{0},ELSE:{MAX(E.ESTOQUE_MIN)}) AS ESTOQUE_MIN,
             0 AS SALDO_COMPRA,
             P.PRODUTO||"_"||E.COR||"_"||E.ESTAMPA||"_"||E.TAMANHO  AS SKU,
             E.FILIAL,
             #SELECT(VITRINE ,NULL:{},ELSE:{SKU.VITRINE_PRODUTO_SKU,SKU.DATA_ENVIO,MAX(SKU.ID_EXTERNO) AS ID_EXTERNO,MAX(#NULL_TO_S(SKU.ID_EXTERNO,SKU.VITRINE_PRODUTO_SKU)) AS ID, E.FILIAL_EXTERNA,
                                           (SELECT #IF(COUNT(*)>0,TRUE,FALSE) FROM VITRINE_PRODUTOS_SKU_KIT VPSK WHERE VPSK.VITRINE_PRODUTO_SKU=SKU.VITRINE_PRODUTO_SKU) AS COMPONENTE_KIT,})
             (SELECT MIN(CB.BARRA) FROM CODIGO_BARRAS CB WHERE CB.PRODUTO=P.PRODUTO AND CB.COR = E.COR AND CB.ESTAMPA = E.ESTAMPA AND CB.TAMANHO = E.TAMANHO AND CB.CLIENTE IS NULL AND CB.FORNECEDOR IS NULL AND CB.TIPO_BARRA IS NULL) AS BARRA,
             #IF((#NULL_TO_S(P.KIT,FALSE) = TRUE) AND (#NULL_TO_S(P.BAIXA_ESTOQUE_FICH,"")="T"),TRUE,FALSE) AS KIT, P.DESCRICAO1 AS DESC_PRODUTO, MAX(E.TRANS_ID) AS TRANS_ID,P.PERMITE_PEDIDO_SEM_ESTOQUE
      FROM (SELECT DISTINCT EE.PRODUTO, EE.COR, EE.ESTAMPA, EE.TAMANHO
            FROM #SELECT(VITRINE ,NULL:{ESTOQUES EE},
                                  ELSE:{VITRINE_ESTOQUE EE})
            [WHERE #SELECT(TRANS_ID,NULL:{EE.DATA_ATUALIZACAO>:DATA_ATUALIZACAO_INICIAL},ELSE:{ EE.TRANS_ID >:TRANS_ID})]) EE
      INNER JOIN (SELECT DISTINCT EE.PRODUTO, EE.COR, EE.ESTAMPA, EE.TAMANHO, EE.FILIAL, EE.DATA_ATUALIZACAO, EE.TRANS_ID, EE.SALDO, EE.EMPENHO,
                                  #SELECT(VITRINE, NULL:{NULL},ELSE:{EE.VITRINE}) AS VITRINE,
                                  #SELECT(VITRINE, NULL:{NULL},ELSE:{EE.RESERVA_NAOVITRINE}) AS RESERVA_NAOVITRINE,
                                  #SELECT(VITRINE, NULL:{NULL},ELSE:{EE.RESERVA_VITRINE}) AS RESERVA_VITRINE,
                                  #SELECT(VITRINE, NULL:{NULL},ELSE:{EE.SALDO_NAOVITRINE}) AS SALDO_NAOVITRINE,
                                  #SELECT(VITRINE, NULL:{NULL},ELSE:{EE.SALDO_VITRINE}) AS SALDO_VITRINE,
                                  #SELECT(VITRINE, NULL:{NULL},ELSE:{EE.ESTOQUE_MIN}) AS ESTOQUE_MIN,
                                  #SELECT(VITRINE, NULL:{NULL},ELSE:{EE.FILIAL_EXTERNA}) AS FILIAL_EXTERNA
                  FROM #SELECT(VITRINE ,NULL:{ESTOQUES EE},
                                        ELSE:{VITRINE_ESTOQUE EE}) ) E ON EE.PRODUTO = E.PRODUTO AND EE.COR = E.COR AND EE.ESTAMPA = E.ESTAMPA AND EE.TAMANHO = E.TAMANHO
      LEFT JOIN (SELECT
                   P.PRODUTO,
                   P.COD_PRODUTO,
                   P.GRADE,
                   P.WEB,
                   P.KIT,
                   P.DIVISAO,
                   P.COLECAO,
                   P.BAIXA_ESTOQUE_FICH,
                   P.DESCRICAO1,
                   P.PERMITE_PEDIDO_SEM_ESTOQUE,
                   PB.PRODUTO as PROD_ALT,
                   P.TIPO
                 FROM PRODUTOS P
                  INNER JOIN PRODUTOS PB ON PB.CODBASE = P.PRODUTO AND PB.ALTERNATIVO_PRODUTO_BASE = "T"
                    UNION ALL
                  SELECT
                    P.PRODUTO,
                    P.COD_PRODUTO,
                    P.GRADE,
                    P.WEB,
                    P.KIT,
                    P.DIVISAO,
                    P.COLECAO,
                    P.BAIXA_ESTOQUE_FICH,
                    P.DESCRICAO1,
                    P.PERMITE_PEDIDO_SEM_ESTOQUE,
                    P.PRODUTO as PROD_ALT,
                    P.TIPO
                  FROM PRODUTOS P) P ON (E.PRODUTO=P.PROD_ALT)
      #SELECT(VITRINE ,NULL:{},ELSE:{
      LEFT JOIN VITRINE_PRODUTOS_SKU SKU ON SKU.PRODUTO = P.PRODUTO AND SKU.COR = E.COR AND SKU.ESTAMPA = E.ESTAMPA AND SKU.TAMANHO = E.TAMANHO AND SKU.VITRINE=E.VITRINE})
      WHERE E.PRODUTO=E.PRODUTO
            #SELECT(VITRINE,NULL:{},
                            ELSE:{#SELECT(LIST_SKUS._EOF,TRUE:{},ELSE:{AND SKU.VITRINE_PRODUTO_SKU IN #MAKELIST(LIST_SKUS.SKUS,ITEM)})
                                  AND (EXISTS(SELECT VP.PRODUTO FROM VITRINE_PRODUTOS VP WHERE (VP.PRODUTO = SKU.PRODUTO OR VP.PRODUTO = SKU.PRODUTO_AGRUPADOR) AND VP.VITRINE = SKU.VITRINE AND #NULL_TO_S(VP.EXCLUIDO,"F") = FALSE) OR
                                       EXISTS(SELECT VPSK.VITRINE_PRODUTO_SKU FROM VITRINE_PRODUTOS_SKU_KIT VPSK WHERE VPSK.VITRINE_PRODUTO_SKU = SKU.VITRINE_PRODUTO_SKU AND VPSK.VITRINE = SKU.VITRINE))
            })
            [AND P.PRODUTO=:PRODUTO]
            [AND E.COR=:COR]
            [AND E.ESTAMPA=:ESTAMPA]
            [AND E.TAMANHO=:TAMANHO]
            [AND E.FILIAL IN #REPLACE(FILIAIS)]
            [AND P.WEB=:WEB]
            [AND P.DIVISAO=:DIVISAO]
            [AND P.MARCA=:MARCA]
            [AND P.COLECAO IN #REPLACE(COLECOES)]
            [AND P.TIPO IN #REPLACE(TIPOS)]
            #SELECT(VITRINE,NULL:{#SELECT(FILIAL,NULL:{},ELSE:{AND E.FILIAL=:FILIAL})},
                            ELSE:{AND E.VITRINE=:VITRINE
                                  #SELECT(ESTOQUE_NIVEL_KIT,TRUE:{AND NOT EXISTS (SELECT VPSK.VITRINE_PRODUTO_SKU FROM VITRINE_PRODUTOS_SKU_KIT VPSK WHERE VPSK.VITRINE_PRODUTO_SKU = SKU.VITRINE_PRODUTO_SKU)},ELSE:{})
            })
      GROUP BY
            P.PRODUTO,
            E.COR,
            E.ESTAMPA,
            E.TAMANHO,
            P.COD_PRODUTO,
            E.FILIAL,
            P.KIT,
            P.BAIXA_ESTOQUE_FICH,
            P.DESCRICAO1,
            P.PERMITE_PEDIDO_SEM_ESTOQUE
            #SELECT(VITRINE,NULL:{},ELSE:{
            ,SKU.VITRINE_PRODUTO_SKU,
            SKU.DATA_ENVIO,
            E.FILIAL_EXTERNA
            })
      #SELECT(COMPRAS,TRUE:{
      UNION ALL
      SELECT  NULL AS DATA_ATUALIZACAO,
              PV.DATA_ENTREGA AS DATA_COMPRA,
              PVV.PRODUTO,
              PVV.COR,
              PVV.ESTAMPA,
              PVV.TAMANHO,
              P.COD_PRODUTO,
              0 AS SALDO,
              0 AS EMPENHO,
              0 AS RESERVA_NAOVITRINE,
              0 AS RESERVA_VITRINE,
              0 AS SALDO_NAOVITRINE,
              0 AS SALDO_VITRINE,
              0 AS SALDO_VITRINE_COM_RESERVA,
              0 AS SALDO_VITRINE_SEM_RESERVA,
              0 AS ESTOQUE_MIN,
              SUM(#NULL_TO_Z(PVV.QUANTIDADE) - #NULL_TO_Z(PVV.ENTREGUE)) AS SALDO_COMPRA,
              PVV.PRODUTO||"_"||PVV.COR||"_"||PVV.ESTAMPA||"_"||PVV.TAMANHO  AS SKU,
              PV.FILIAL,
              #SELECT(VITRINE ,NULL:{},ELSE:{
              SKU.VITRINE_PRODUTO_SKU,
              SKU.DATA_ENVIO,
              MAX(SKU.ID_EXTERNO) AS ID_EXTERNO,
              MAX(#NULL_TO_S(SKU.ID_EXTERNO,SKU.VITRINE_PRODUTO_SKU)) AS ID,
              NULL AS FILIAL_EXTERNA,
              (SELECT #IF(COUNT(*)>0,TRUE,FALSE)
                 FROM VITRINE_PRODUTOS_SKU_KIT VPSK
               WHERE VPSK.VITRINE_PRODUTO_SKU=SKU.VITRINE_PRODUTO_SKU
              ) AS COMPONENTE_KIT,
              })
              (SELECT MIN(CB.BARRA)
                FROM CODIGO_BARRAS CB
               WHERE CB.PRODUTO=PVV.PRODUTO
                 AND CB.COR = PVV.COR
                 AND CB.ESTAMPA = PVV.ESTAMPA
                 AND CB.TAMANHO = PVV.TAMANHO
                 AND CB.CLIENTE IS NULL
                 AND CB.FORNECEDOR IS NULL
                 AND CB.TIPO_BARRA IS NULL
              ) AS BARRA,
              #IF((#NULL_TO_S(P.KIT,FALSE) = TRUE)
                AND (#NULL_TO_S(P.BAIXA_ESTOQUE_FICH,"")="T"),TRUE,FALSE
              ) AS KIT,
              P.DESCRICAO1 AS DESC_PRODUTO,
              MAX(PVV.TRANS_ID_ESTOQUE) AS TRANS_ID,
              P.PERMITE_PEDIDO_SEM_ESTOQUE
      FROM PEDIDOC_NAOEFETUADOS PNE
      LEFT JOIN PEDIDO_COMPRA PV ON PV.PEDIDOC = PNE.PEDIDOC
      LEFT JOIN PRODUTO_PEDIDOC PVV ON PVV.PEDIDOC = PV.PEDIDOC
      #SELECT(VITRINE ,NULL:{},ELSE:{
      LEFT JOIN VITRINE_PRODUTOS_SKU SKU ON SKU.PRODUTO = PVV.PRODUTO
                                        AND SKU.COR = PVV.COR
                                        AND SKU.ESTAMPA = PVV.ESTAMPA
                                        AND SKU.TAMANHO = PVV.TAMANHO
                                        AND SKU.VITRINE=PV.VITRINE
      LEFT JOIN VITRINE V ON V.VITRINE=SKU.VITRINE
      })
      LEFT JOIN PRODUTOS P ON PVV.PRODUTO = P.PRODUTO
      WHERE PNE.PEDIDOC=PNE.PEDIDOC
           [AND PVV.PRODUTO=:PRODUTO]
           [AND PVV.COR=:COR]
           [AND PVV.ESTAMPA=:ESTAMPA]
           [AND PVV.TAMANHO=:TAMANHO]
           [AND PV.VITRINE=:VITRINE]
           [AND PV.FILIAL IN #REPLACE(FILIAIS)]
           [AND P.WEB=:WEB]
           [AND P.DIVISAO=:DIVISAO]
           [AND P.MARCA=:MARCA]
           [AND P.COLECAO IN #REPLACE(COLECOES)]
           [AND P.TIPO IN #REPLACE(TIPOS)]
           #SELECT(VITRINE,NULL:{#SELECT(FILIAL,NULL:{},ELSE:{AND PV.FILIAL=:FILIAL})},
                           ELSE:{AND PV.FILIAL=V.FILIAL
                                 #SELECT(ESTOQUE_NIVEL_KIT,TRUE:{AND NOT EXISTS (SELECT VPSK.VITRINE_PRODUTO_SKU FROM VITRINE_PRODUTOS_SKU_KIT VPSK WHERE VPSK.VITRINE_PRODUTO_SKU = SKU.VITRINE_PRODUTO_SKU)},ELSE:{})
                                 AND (EXISTS(SELECT VP.PRODUTO FROM VITRINE_PRODUTOS VP WHERE VP.PRODUTO = SKU.PRODUTO AND VP.VITRINE = SKU.VITRINE AND #NULL_TO_S(VP.EXCLUIDO,"F") = FALSE) OR
                                       EXISTS(SELECT VPSK.VITRINE_PRODUTO_SKU FROM VITRINE_PRODUTOS_SKU_KIT VPSK WHERE VPSK.VITRINE_PRODUTO_SKU = SKU.VITRINE_PRODUTO_SKU AND VPSK.VITRINE = SKU.VITRINE))
                                 #SELECT(LIST_SKUS._EOF,TRUE:{},ELSE:{AND SKU.VITRINE_PRODUTO_SKU IN #MAKELIST(LIST_SKUS.SKUS,ITEM)})
           })
      GROUP BY PVV.PRODUTO,PVV.COR,PVV.ESTAMPA,PVV.TAMANHO,P.COD_PRODUTO, PV.DATA_ENTREGA,PV.FILIAL,P.KIT,P.BAIXA_ESTOQUE_FICH,P.DESCRICAO1,P.PERMITE_PEDIDO_SEM_ESTOQUE
               #SELECT(VITRINE,NULL:{},ELSE:{,SKU.VITRINE_PRODUTO_SKU,SKU.DATA_ENVIO})
      },ELSE:{})
      #SELECT(VITRINE,NULL:{},ELSE:{#SELECT(ESTOQUE_NIVEL_KIT,TRUE:{
      UNION ALL
      SELECT MAX(V.DATA_ATUALIZACAO) AS DATA_ATUALIZACAO, CAST(NULL AS TIMESTAMP) AS DATA_COMPRA,
             V.PRODUTO,
             V.COR,
             V.ESTAMPA,
             V.TAMANHO,
             V.COD_PRODUTO,
             MIN(V.SALDO) AS SALDO,
             MIN(V.EMPENHO) AS EMPENHO,
             MIN(V.RESERVA_VITRINE) AS RESERVA_VITRINE,
             MIN(V.RESERVA_NAOVITRINE) AS RESERVA_NAOVITRINE,
             MIN(V.SALDO_NAOVITRINE) AS SALDO_NAOVITRINE,
             MIN(V.SALDO_VITRINE) AS SALDO_VITRINE,
             MIN(V.SALDO_VITRINE_COM_RESERVA) AS SALDO_VITRINE_COM_RESERVA,
             MIN(V.SALDO_VITRINE_SEM_RESERVA) AS SALDO_VITRINE_SEM_RESERVA,
             MIN(V.ESTOQUE_MIN) AS ESTOQUE_MIN,
             0 AS SALDO_COMPRA,
             V.PRODUTO || "_" || V.COR || "_" || V.ESTAMPA || "_" || V.TAMANHO AS SKU,
             V.FILIAL,
             V.VITRINE_PRODUTO_SKU,
             MIN(V.DATA_ENVIO) AS DATA_ENVIO,
             V.ID_EXTERNO,
             V.ID,
             V.FILIAL_EXTERNA,
             FALSE AS COMPONENTE_KIT,
             V.BARRA,TRUE AS KIT,
             V.DESC_PRODUTO,
             MAX(V.TRANS_ID) AS TRANS_ID,
             V.PERMITE_PEDIDO_SEM_ESTOQUE
      FROM (SELECT:KIT VPS.VITRINE_PRODUTO_SKU,VPS.PRODUTO,VPS.COR,VPS.ESTAMPA,VPS.TAMANHO,P.COD_PRODUTO,VPS.DATA_ENVIO,VPS.ID_EXTERNO,
           #NULL_TO_S(VPS.ID_EXTERNO, VPS.VITRINE_PRODUTO_SKU) AS ID,
          (SELECT MIN(CB.BARRA) FROM CODIGO_BARRAS CB WHERE CB.PRODUTO=VPS.PRODUTO AND CB.COR = VPS.COR AND CB.ESTAMPA = VPS.ESTAMPA AND CB.TAMANHO = VPS.TAMANHO AND CB.CLIENTE IS NULL AND CB.FORNECEDOR IS NULL AND CB.TIPO_BARRA IS NULL) AS BARRA,
           P.DESCRICAO1 AS DESC_PRODUTO,P.PERMITE_PEDIDO_SEM_ESTOQUE,
           #DIV(VE.SALDO,VE.QUANTIDADE) AS SALDO,
           #DIV(VE.SALDO_VITRINE,VE.QUANTIDADE) AS SALDO_VITRINE,
           #DIV(VE.SALDO_NAOVITRINE,VE.QUANTIDADE) AS SALDO_NAOVITRINE,
           #DIV(VE.RESERVA_VITRINE,VE.QUANTIDADE) AS RESERVA_VITRINE,
           #DIV(VE.RESERVA_NAOVITRINE,VE.QUANTIDADE) AS RESERVA_NAOVITRINE,
           #DIV(VE.SALDO_VITRINE_COM_RESERVA,VE.QUANTIDADE) AS SALDO_VITRINE_COM_RESERVA,
           #DIV(VE.SALDO_VITRINE_SEM_RESERVA,VE.QUANTIDADE) AS SALDO_VITRINE_SEM_RESERVA,
           #DIV(VE.EMPENHO,VE.QUANTIDADE) AS EMPENHO,
           V1.FILIAL,VE.FILIAL_EXTERNA,VE.ESTOQUE_MIN,VE.DATA_ATUALIZACAO,VE.TRANS_ID
           FROM (SELECT DISTINCT VPSK1.VITRINE_PRODUTO_SKU_PAI,VE.FILIAL,VE.VITRINE FROM VITRINE_PRODUTOS_SKU_KIT VPSK1
                 INNER JOIN VITRINE_ESTOQUE VE ON VE.VITRINE_PRODUTO_SKU = VPSK1.VITRINE_PRODUTO_SKU AND VE.VITRINE = VPSK1.VITRINE
                 WHERE VE.VITRINE=:VITRINE
                       [AND VE.FILIAL IN #REPLACE(FILIAIS)]
                       #SELECT(TRANS_ID,NULL:{[AND (VE.DATA_ATUALIZACAO>:DATA_ATUALIZACAO_INICIAL)]},ELSE:{AND VE.TRANS_ID >:TRANS_ID}))V1
           INNER JOIN VITRINE_PRODUTOS_SKU VPS ON VPS.VITRINE_PRODUTO_SKU = V1.VITRINE_PRODUTO_SKU_PAI
           INNER JOIN (SELECT VPSK.VITRINE_PRODUTO_SKU_PAI, VE.PRODUTO, VE.COR, VE.ESTAMPA, VE.TAMANHO,
                              SUM(VE.SALDO) AS SALDO,
                              SUM(VE.SALDO_VITRINE) AS SALDO_VITRINE,
                              #IF(SUM(VE.SALDO_NAOVITRINE)&lt;0,0,SUM(VE.SALDO_NAOVITRINE)) AS SALDO_NAOVITRINE,
                              SUM(VE.RESERVA_VITRINE) AS RESERVA_VITRINE,
                              #IF(SUM(VE.RESERVA_NAOVITRINE)&lt;0,0,SUM(VE.RESERVA_NAOVITRINE)) AS RESERVA_NAOVITRINE,
                              (((SUM(VE.SALDO) + SUM(VE.RESERVA_VITRINE))-(#IF(SUM(VE.SALDO_NAOVITRINE)&lt;0,0,SUM(VE.SALDO_NAOVITRINE)) - #IF(SUM(VE.RESERVA_NAOVITRINE)&lt;0,0,SUM(VE.RESERVA_NAOVITRINE)))) - MAX(VE.ESTOQUE_MIN)) AS SALDO_VITRINE_COM_RESERVA,
                              ((SUM(VE.SALDO))-(SUM(VE.SALDO_VITRINE) - SUM(VE.RESERVA_VITRINE))-(#IF(SUM(VE.SALDO_NAOVITRINE)&lt;0,0,SUM(VE.SALDO_NAOVITRINE)) - #IF(SUM(VE.RESERVA_NAOVITRINE)&lt;0,0,SUM(VE.RESERVA_NAOVITRINE))) - MAX(VE.ESTOQUE_MIN)) AS SALDO_VITRINE_SEM_RESERVA,
                              SUM(VE.EMPENHO) AS EMPENHO,
                              MAX(VE.ESTOQUE_MIN) AS ESTOQUE_MIN,
                              MIN(VE.FILIAL)AS FILIAL,
                              MIN(VE.FILIAL_EXTERNA) AS FILIAL_EXTERNA,
                              MIN(VE.DATA_ATUALIZACAO) AS DATA_ATUALIZACAO,
                              MIN(VPSK.QUANTIDADE) AS QUANTIDADE,
                              MAX(VE.TRANS_ID) AS TRANS_ID
                       FROM VITRINE_PRODUTOS_SKU_KIT VPSK
                       INNER JOIN VITRINE_ESTOQUE VE ON VE.VITRINE_PRODUTO_SKU = VPSK.VITRINE_PRODUTO_SKU AND VE.VITRINE = VPSK.VITRINE AND VE.FILIAL = :KIT.FILIAL
                       WHERE VPSK.VITRINE_PRODUTO_SKU_PAI = :KIT.VITRINE_PRODUTO_SKU AND VPSK.VITRINE =:VITRINE
                       GROUP BY VPSK.VITRINE_PRODUTO_SKU_PAI, VE.PRODUTO, VE.COR, VE.ESTAMPA, VE.TAMANHO)VE ON VE.VITRINE_PRODUTO_SKU_PAI = VPS.VITRINE_PRODUTO_SKU
           INNER JOIN PRODUTOS P ON P.PRODUTO = VPS.PRODUTO
           WHERE P.PRODUTO=P.PRODUTO
                 #SELECT(LIST_SKUS._EOF,TRUE:{},ELSE:{AND VPS.VITRINE_PRODUTO_SKU IN #MAKELIST(LIST_SKUS.SKUS,ITEM)})
                 [AND VPS.PRODUTO=:PRODUTO]
                 [AND VPS.COR=:COR]
                 [AND VPS.ESTAMPA=:ESTAMPA]
                 [AND VPS.TAMANHO=:TAMANHO]
                 [AND P.WEB=:WEB]
                 [AND P.DIVISAO=:DIVISAO]
                 [AND P.MARCA=:MARCA]
                 [AND P.COLECAO IN #REPLACE(COLECOES)]
                 [AND P.TIPO IN #REPLACE(TIPOS)]
                 )V
      GROUP BY V.VITRINE_PRODUTO_SKU,
               V.FILIAL,
               V.FILIAL_EXTERNA,
               V.PRODUTO,
               V.COR,
               V.ESTAMPA,
               V.TAMANHO,
               V.COD_PRODUTO,
               V.ID_EXTERNO,
               V.ID,
               V.BARRA,
               V.DESC_PRODUTO,
               V.PERMITE_PEDIDO_SEM_ESTOQUE
      },ELSE:{})})
)R
INNER JOIN PRODUTOS PD ON PD.PRODUTO = R.PRODUTO
INNER JOIN CORES    CR ON CR.COR = R.COR
INNER JOIN COLECOES CL ON CL.COLECAO = COALESCE(PD.COLECAO,-2000000000)
INNER JOIN TIPOS    TP ON TP.TIPO = COALESCE(PD.TIPO,-2000000000)
WHERE PD.TIPO_PROD = 'AC'

GROUP BY
  #SELECT(AGRUPA_PRODUTO,
         '1':{R.PRODUTO},
         '2':{R.PRODUTO,R.COR},
         '3':{R.PRODUTO,R.COR,R.TAMANHO},
         ELSE:{}
  )
  //R.COD_PRODUTO,
  //R.ESTAMPA,
  //R.TAMANHO,
  //R.BARRA,
  //R.KIT,
  //R.DESC_PRODUTO,
  //R.PERMITE_PEDIDO_SEM_ESTOQUE
  //       #SELECT(VITRINE,NULL:{},ELSE:{,R.VITRINE_PRODUTO_SKU,R.DATA_ENVIO,R.COMPONENTE_KIT
  //               #SELECT(AGRUPAR_FILIAIS,true:{},else:{,R.FILIAL_EXTERNA})})

#SELECT(ESTOQUE_DISPONIVEL,
  TRUE: {HAVING SUM(R.SALDO_VITRINE_SEM_RESERVA)>0},
  FALSE:{HAVING SUM(R.SALDO_VITRINE_SEM_RESERVA)&lt;0},
  ELSE: {}
)

//ORDER BY V.PRODUTO

//ORDER BY #SELECT(TRANS_ID,NULL:{1},ELSE:{V.TRANS_ID})

</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>