<?xml version="1.0"?>
<root>
  <OBJECT NAME="PLANEJAMENTOS_ESTOQUES">
    <METHOD NAME="ListarItensPlanejamento" DESCRIPTION="" VERSION="33" THREADSAFE="1">
      <PARAMS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <PARAM NAME="PLANEJAMENTO_ESTOQUE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="1" FIELDLABEL="Planejamento Estoque" CTAB="0"/>
      </PARAMS>
      <FIELDS>
        <GROUPS>
          <GROUP/>
        </GROUPS>
        <FIELD NAME="PLAN_ESTOQUE_PRODUTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="5" FIELDLABEL="Plan Estoque Produto" CTAB="0"/>
        <FIELD NAME="PLANEJAMENTO_ESTOQUE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="6" FIELDLABEL="Planejamento Estoque" CTAB="0"/>
        <FIELD NAME="PRODUTO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="7" FIELDLABEL="Produto" CTAB="0"/>
        <FIELD NAME="COR" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="3" FIELDLABEL="Cor" CTAB="0"/>
        <FIELD NAME="ESTAMPA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="4" FIELDLABEL="Estampa" CTAB="0"/>
        <FIELD NAME="TAMANHO" SIZE="5" FLAGS="1" PROJECTION="0" ORDER="12" FIELDLABEL="Tamanho" CTAB="0"/>
        <FIELD NAME="QTD_PROP_GRADE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="10" FIELDLABEL="Qtd Prop Grade" CTAB="0"/>
        <FIELD NAME="QTD_VENDA" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="11" FIELDLABEL="Qtd Venda" CTAB="0"/>
        <FIELD NAME="QTD_ESTOQUE" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="8" FIELDLABEL="Qtd Estoque" CTAB="0"/>
        <FIELD NAME="QTD_PRODUZIDO" FORMAT="N" SIZE="8" FLAGS="1" PROJECTION="0" ORDER="9" FIELDLABEL="Qtd Produzido" CTAB="0"/>
        <FIELD NAME="VENDAS" FORMAT="R" FLAGS="1" PROJECTION="0" ORDER="13" FIELDLABEL="Vendas" NESTEDNAME="MILLENIUM!QIX.PLANEJAMENTOS_ESTOQUES.VENDA" CTAB="0"/>
        <FIELD NAME="COD_PRODUTO" SIZE="20" FLAGS="1" PROJECTION="0" FIELDLABEL="Cod Produto" CTAB="0"/>
        <FIELD NAME="DESC_COR" SIZE="30" FLAGS="1" PROJECTION="0" FIELDLABEL="Desc Cor" CTAB="0"/>
        <FIELD NAME="PERIODOS" FORMAT="R" FLAGS="1" PROJECTION="0" FIELDLABEL="Qtd Periodos" NESTEDNAME="WTSSYSTEM.INTERNALTYPES.INTEGERARRAY" CTAB="0"/>
      </FIELDS>
      <ACTIONSCRIPT>SELECT:MAIN
       PEP.PLAN_ESTOQUE_PRODUTO,
       PEP.PLANEJAMENTO_ESTOQUE,
       PEP.PRODUTO,
       PEP.COR,
       PEP.ESTAMPA,
       PEP.TAMANHO,
       PEP.QTD_PROP_GRADE,
       PEP.QTD_VENDA,
       PEP.QTD_ESTOQUE,
       PEP.QTD_PRODUZIDO,
       P.COD_PRODUTO,
       C.DESCRICAO AS DESC_COR,
       #ROWSET({SELECT:PERIODOS VALOR AS ITEM FROM QIX_PAN_ESTOQUE_FILTROS WHERE PLANEJAMENTO_ESTOQUE = :PLANEJAMENTO_ESTOQUE AND TIPO = 0})
       #ROWSET({SELECT:VENDAS PERIODO,
                              SUM(QTD_VENDA) AS QTD_VENDA,
                              APROVADO
                FROM QIX_PLAN_ESTOQUE_VENDAS
                WHERE PLANEJAMENTO_ESTOQUE=:PLANEJAMENTO_ESTOQUE AND
                      PRODUTO=:MAIN.PRODUTO
                GROUP BY PERIODO,APROVADO})
FROM QIX_PLAN_ESTOQUE_PRODUTOS PEP
INNER JOIN PRODUTOS P ON (P.PRODUTO = PEP.PRODUTO)
INNER JOIN CORES C ON (C.COR = PEP.COR)
INNER JOIN TAM_ORDS TAM ON (TAM.TAMANHO = PEP.TAMANHO)
WHERE PLANEJAMENTO_ESTOQUE=:PLANEJAMENTO_ESTOQUE AND
      EXISTS(SELECT * FROM QIX_PLAN_ESTOQUE_VENDAS V
             WHERE V.PLANEJAMENTO_ESTOQUE=:PLANEJAMENTO_ESTOQUE AND
                   V.PRODUTO = PEP.PRODUTO)
ORDER BY P.GRADE, PEP.PRODUTO,PEP.COR,PEP.ESTAMPA,TAM.ORDEM;
</ACTIONSCRIPT>
    </METHOD>
  </OBJECT>
</root>